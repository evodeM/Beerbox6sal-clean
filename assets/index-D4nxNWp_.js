import{a as e,j as t,B as a,r as s,g as n,u as r,i,C as o,T as l,I as c,G as d,P as h,b as u,c as x,d as m,A as p,e as f,f as j,h as g,k as b,l as y,m as v,F as S,S as k,D as w,n as P,o as C,p as D,q as I,s as M,t as N,v as B,w as K,x as L,L as O,y as A,z,E as W,H as E,J as R,K as V,M as _,N as F,O as H}from"./vendor-mui-DI5jTO2D.js";import{O as T,u as $,a as q,B as G,R as U,b as Y}from"./vendor-react-BptVVrSd.js";import{i as J,g as X,e as Q,q as Z,c as ee,o as te,a as ae,d as se,b as ne,u as re,s as ie,f as oe,h as le,w as ce,T as de,j as he,k as ue,l as xe}from"./vendor-firebase-DAU0XHoe.js";var me;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var pe=e;me=pe.createRoot,pe.hydrateRoot;const fe=()=>t.jsx(a,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"#1a1a1a"},children:t.jsx(a,{component:"main",sx:{flexGrow:1},children:t.jsx(T,{})})}),je=X(J({apiKey:"AIzaSyBfzh_QQFaKhGXLuVJXbSVkBuOZOvXLBRg",authDomain:"fridge6sal-5b0f6.firebaseapp.com",projectId:"fridge6sal-5b0f6",storageBucket:"fridge6sal-5b0f6.appspot.com",messagingSenderId:"1091624932154",appId:"1:1091624932154:web:b5e0e3d9c5c9b5e5d8e5c5"}));Q(je).catch((e=>{"failed-precondition"===e.code||e.code}));const ge=(e,t=[],a={})=>{const[n,r]=s.useState([]),[i,o]=s.useState(!0),l=s.useRef(new Map),{realtime:c=!1}=a;return s.useEffect((()=>{const a=Z(ee(je,e),...t),s=`${e}-${t.join("-")}`;l.current.has(s)&&(r(l.current.get(s)),o(!1));if(c){const e=te(a,(e=>{const t=[];e.forEach((e=>{t.push({id:e.id,...e.data()})})),r(t),l.current.set(s,t),o(!1)}));return()=>e()}(async()=>{try{const e=await ae(a),t=[];e.forEach((e=>{t.push({id:e.id,...e.data()})})),r(t),l.current.set(s,t),o(!1)}catch(e){o(!1)}})()}),[e,t.join("-"),c]),{data:n,loading:i}};var be={},ye={};const ve=n(r);var Se;function ke(){return Se||(Se=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=ve}(ye)),ye}var we=i;Object.defineProperty(be,"__esModule",{value:!0});var Pe=be.default=void 0,Ce=we(ke()),De=t;Pe=be.default=(0,Ce.default)((0,De.jsx)("path",{d:"M9.68 13.69 12 11.93l2.31 1.76-.88-2.85L15.75 9h-2.84L12 6.19 11.09 9H8.25l2.31 1.84zM20 10c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 2.03.76 3.87 2 5.28V23l6-2 6 2v-7.72c1.24-1.41 2-3.25 2-5.28m-8-6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6"}),"WorkspacePremium");var Ie={},Me=i;Object.defineProperty(Ie,"__esModule",{value:!0});var Ne=Ie.default=void 0,Be=Me(ke()),Ke=t;Ne=Ie.default=(0,Be.default)((0,Ke.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings");const Le=()=>{const e=$(),{data:n,loading:r}=ge("rooms",[],{realtime:!1}),i=s.useMemo((()=>Math.max(...n.map((e=>e.balance||0)))),[n]),u=s.useMemo((()=>n.reduce(((e,t)=>(e[t.id]=t,e)),{})),[n]),x=({roomId:a})=>{const s=u[a]||{occupantName:"",balance:0},n=s.balance===i&&s.balance>0;return t.jsxs(h,{elevation:3,sx:{p:2,height:"100%",cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#fff",borderRadius:"8px",transition:"all 0.2s ease-in-out",position:"relative","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 16px rgba(0,0,0,0.1)"}},onClick:()=>(t=>{e(`/room/${t}`)})(a),children:[n&&t.jsx(Pe,{sx:{position:"absolute",top:-10,right:-10,color:"#ffd700",fontSize:"2rem",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))",transform:"rotate(12deg)"}}),t.jsx(l,{variant:"h5",component:"div",sx:{color:"#2c3e50",fontWeight:"bold",mb:.5},children:a}),t.jsx(l,{variant:"body1",sx:{color:"#666",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"100%",px:2},children:s.occupantName||"Tomt værelse"})]})};return t.jsxs(o,{maxWidth:"lg",sx:{py:2,px:1},children:[t.jsxs(a,{sx:{mb:2,textAlign:"center"},children:[t.jsx(l,{variant:"h3",component:"h1",sx:{color:"#fff",mb:.5},children:"DormDrinks 6.sal"}),t.jsx(l,{variant:"h5",component:"h2",sx:{color:"#fff",mb:2},children:"Beer, Soda & Beyond"})]}),t.jsx(a,{sx:{position:"relative",mb:2},children:t.jsx(c,{onClick:()=>{e("/admin")},sx:{position:"absolute",right:0,top:"-45px",color:"#fff"},children:t.jsx(Ne,{})})}),t.jsx(d,{container:!0,spacing:1.5,children:Array.from({length:28},((e,t)=>t+601)).map((e=>t.jsx(d,{item:!0,xs:6,sm:4,md:3,children:t.jsx(x,{roomId:e.toString()})},e)))})]})};var Oe={},Ae=i;Object.defineProperty(Oe,"__esModule",{value:!0});var ze=Oe.default=void 0,We=Ae(ke()),Ee=t;ze=Oe.default=(0,We.default)((0,Ee.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var Re={},Ve=i;Object.defineProperty(Re,"__esModule",{value:!0});var _e=Re.default=void 0,Fe=Ve(ke()),He=t;_e=Re.default=(0,Fe.default)((0,He.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");const Te=async e=>{try{const t=se(je,"rooms",e),a=await ne(t);return a.exists()?{id:a.id,...a.data()}:null}catch(t){throw t}},$e=async()=>{try{const e=ee(je,"products"),t=await ae(e);return t.docs.map((e=>({id:e.id,...e.data()})))}catch(e){throw e}},qe=[{id:"beer",name:"Øl",price:7},{id:"soda",name:"Sodavand",price:5},{id:"snacks",name:"Snacks",price:10},{id:"water",name:"Vand",price:3}],Ge=()=>{var e,n;const{roomId:r}=q(),i=$(),[c,m]=s.useState({occupantName:"",balance:0}),[p,f]=s.useState(qe),[j,g]=s.useState(!0);s.useEffect((()=>{(async()=>{try{await(async()=>{try{const e=ee(je,"products");if((await ae(e)).empty){const t=[{id:"beer",name:"Øl",price:7},{id:"soda",name:"Sodavand",price:5},{id:"snacks",name:"Snacks",price:10},{id:"water",name:"Vand",price:3}];for(const a of t)await le(se(e,a.id),{name:a.name,price:a.price})}for(let a=601;a<=628;a++){const e=se(je,"rooms",a.toString());(await ne(e)).exists()||await le(e,{occupantName:"",balance:0,lastPurchase:null})}const t=se(je,"adminConfig","general");(await ne(t)).exists()||await le(t,{mobilePayPhoneNumber:"",adminPassword:"admin123"})}catch(e){throw e}})();const[e,t]=await Promise.all([Te(r),$e()]);m(e||{occupantName:"",balance:0}),f(t.length>0?t:qe)}catch(e){f(qe)}finally{g(!1)}})()}),[r]);const b=async e=>{try{await(async(e,t)=>{try{const a=se(je,"rooms",e);await re(a,t)}catch(a){throw a}})(r,{occupantName:e}),m((t=>({...t,occupantName:e})))}catch(t){}},y=async e=>{try{const t=p.find((t=>t.id===e));if(!t)return;const a=(c.balance||0)+t.price,s=new Date;m((e=>({...e,balance:a,lastPurchase:{productName:t.name,amount:t.price,timestamp:s}}))),await(async e=>{var t;try{const a=ee(je,"purchases"),s={...e,timestamp:ie()};await oe(a,s);const n=se(je,"rooms",e.roomId),r=(null==(t=(await ne(n)).data())?void 0:t.balance)||0;await re(n,{balance:r+e.amount,lastPurchase:{productName:e.productName,amount:e.amount,timestamp:ie()}})}catch(a){throw a}})({roomId:r,productId:e,productName:t.name,amount:t.price})}catch(t){const e=await Te(r);m(e||{occupantName:"",balance:0})}};return t.jsxs(a,{sx:{bgcolor:"#f5f6fa",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[t.jsxs(o,{maxWidth:"sm",sx:{py:4,flex:1},children:[t.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:6},children:[t.jsxs(l,{variant:"h3",component:"h1",sx:{color:"#2c3e50",fontWeight:"bold",mb:2},children:["Værelse ",r]}),t.jsx(a,{sx:{position:"relative",width:"100%",maxWidth:300},children:t.jsx(u,{variant:"outlined",placeholder:"Klik for at tilføje beboer",value:c.occupantName,onChange:e=>b(e.target.value),sx:{width:"100%","& .MuiOutlinedInput-root":{fontSize:"1.2rem",textAlign:"center","& fieldset":{borderColor:"rgba(0,0,0,0.2)"},"&:hover fieldset":{borderColor:"#e74c3c"},"&.Mui-focused fieldset":{borderColor:"#e74c3c"},"& input":{textAlign:"center",color:"#2c3e50","&::placeholder":{color:"#666",opacity:.7}}}},InputProps:{endAdornment:t.jsx(_e,{sx:{color:"#666",opacity:.7,mr:1,transition:"all 0.2s",".MuiOutlinedInput-root:hover &":{color:"#e74c3c",opacity:1}}})}})})]}),t.jsxs(h,{elevation:3,sx:{p:4,mb:4,textAlign:"center",bgcolor:c.balance>0?"#fff3e0":"white",borderRadius:3},children:[t.jsx(l,{variant:"h6",sx:{color:"#666",mb:1},children:"SALDO"}),t.jsxs(l,{variant:"h2",sx:{color:c.balance>0?"#e74c3c":"#2c3e50",fontWeight:"bold"},children:[null==(e=c.balance)?void 0:e.toFixed(2)," kr"]})]}),c.lastPurchase&&t.jsxs(h,{elevation:3,sx:{bgcolor:"white",p:3,mb:4,borderRadius:3},children:[t.jsx(l,{variant:"overline",sx:{color:"#666",display:"block",mb:1,fontSize:"0.85rem"},children:"SENESTE KØB"}),t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(l,{variant:"h6",sx:{color:"#2c3e50",fontWeight:"bold"},children:c.lastPurchase.productName}),t.jsxs(a,{sx:{textAlign:"right"},children:[t.jsxs(l,{sx:{color:"#e74c3c",fontSize:"1.1rem",fontWeight:"bold"},children:[null==(n=c.lastPurchase.amount)?void 0:n.toFixed(2)," kr"]}),t.jsx(l,{sx:{color:"#666",fontSize:"0.9rem"},children:(e=>{if(!e)return"";return(e instanceof Date?e:e.toDate()).toLocaleString("da-DK",{hour:"2-digit",minute:"2-digit"})})(c.lastPurchase.timestamp)})]})]})]}),t.jsx(d,{container:!0,spacing:2,children:p.map((e=>t.jsx(d,{item:!0,xs:6,children:t.jsxs(x,{fullWidth:!0,variant:"contained",onClick:()=>y(e.id),sx:{bgcolor:"#e74c3c",py:2,borderRadius:2,fontSize:"1.1rem",fontWeight:"bold",boxShadow:"0 2px 8px rgba(231,76,60,0.3)",display:"flex",flexDirection:"column","&:hover":{bgcolor:"#c0392b",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(231,76,60,0.4)"}},children:[t.jsx(a,{children:e.name}),t.jsxs(l,{variant:"body2",sx:{opacity:.9,fontSize:"0.9rem",fontWeight:"normal"},children:[e.price," kr"]})]})},e.id)))})]}),t.jsx(a,{sx:{p:2,borderTop:"1px solid rgba(0,0,0,0.1)",bgcolor:"white"},children:t.jsx(o,{maxWidth:"sm",children:t.jsx(x,{fullWidth:!0,variant:"text",onClick:()=>i("/"),startIcon:t.jsx(ze,{}),sx:{color:"#666",py:1.5,fontSize:"1rem","&:hover":{bgcolor:"rgba(0,0,0,0.05)",color:"#2c3e50"}},children:"Tilbage til oversigt"})})})]})},Ue=()=>{const[e,n]=s.useState([]),[r,i]=s.useState(!0),[o,c]=s.useState(""),[d,S]=s.useState(""),[k,w]=s.useState({});s.useEffect((()=>{P()}),[]);const P=async()=>{try{const e=ee(je,"products"),t=(await ae(e)).docs.map((e=>({id:e.id,...e.data()})));n(t),w(t.reduce(((e,t)=>({...e,[t.id]:{name:t.name,price:t.price}})),{}))}catch(e){c("Fejl ved indlæsning af produkter")}finally{i(!1)}},C=(e,t,a)=>{w((s=>({...s,[e]:{...s[e],[t]:"price"===t?Number(a):a}})))};return r?t.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(m,{})}):t.jsxs(h,{sx:{p:3},children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Produkt Administration"}),o&&t.jsx(p,{severity:"error",sx:{mb:2},children:o}),d&&t.jsx(p,{severity:"success",sx:{mb:2},children:d}),t.jsx(f,{children:t.jsxs(j,{children:[t.jsx(g,{children:t.jsxs(b,{children:[t.jsx(y,{children:"Produkt"}),t.jsx(y,{children:"Pris (DKK)"})]})}),t.jsx(v,{children:e.map((e=>{var a,s;return t.jsxs(b,{children:[t.jsx(y,{children:t.jsx(u,{fullWidth:!0,value:(null==(a=k[e.id])?void 0:a.name)||"",onChange:t=>C(e.id,"name",t.target.value)})}),t.jsx(y,{children:t.jsx(u,{type:"number",value:(null==(s=k[e.id])?void 0:s.price)||0,onChange:t=>C(e.id,"price",t.target.value),InputProps:{inputProps:{min:0,step:1}}})})]},e.id)}))})]})}),t.jsx(a,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:t.jsx(x,{variant:"contained",color:"primary",onClick:async()=>{i(!0),c("");try{await Promise.all(e.map((async e=>{const t=k[e.id];!t||t.name===e.name&&t.price===e.price||await re(se(je,"products",e.id),{name:t.name,price:t.price})}))),S("Produkter opdateret"),P()}catch(t){c("Fejl ved opdatering af produkter")}finally{i(!1)}},disabled:r,children:"Gem Ændringer"})})]})},Ye=()=>{const[e,n]=s.useState(""),[r,i]=s.useState(!1),[o,c]=s.useState(!1),[d,f]=s.useState(""),[j,g]=s.useState("");return t.jsxs(h,{sx:{p:3},children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Send Beskeder"}),d&&t.jsx(p,{severity:"error",sx:{mb:2},children:d}),j&&t.jsx(p,{severity:"success",sx:{mb:2},children:j}),t.jsx(a,{sx:{mb:3},children:t.jsx(S,{control:t.jsx(k,{checked:r,onChange:e=>i(e.target.checked),name:"endOfMonth"}),label:"Månedlig betalingspåmindelse"})}),t.jsx(u,{fullWidth:!0,multiline:!0,rows:4,label:"Besked",value:e,onChange:e=>n(e.target.value),disabled:r,sx:{mb:3}}),t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:r?"Der vil blive sendt en påmindelse til alle beboere med deres aktuelle saldo.":"Skriv en besked der skal sendes til alle beboere."}),t.jsx(x,{variant:"contained",color:"primary",onClick:async()=>{if(e.trim()||r){c(!0),f(""),g("");try{const t=(await ae(ee(je,"rooms"))).docs.map((e=>({id:e.id,...e.data()}))),a=ee(je,"fcmTokens"),s=(await ae(a)).docs.reduce(((e,t)=>{const a=t.data();return a.roomId&&a.token&&(e[a.roomId]||(e[a.roomId]=[]),e[a.roomId].push(a.token)),e}),{});await Promise.all(t.map((async t=>{const a={roomId:t.id,message:r?`Hej ${t.occupantName||"beboer"}! Din saldo er ${t.balance} kr. Venligst betal inden månedens udgang.`:e,timestamp:new Date,read:!1,type:r?"payment":"announcement"};if(await oe(ee(je,"notifications"),a),s[t.id]&&s[t.id].length>0)try{if(!(await fetch("https://us-central1-dorm-sales-app.cloudfunctions.net/sendPushNotification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tokens:s[t.id],title:r?"Betalingspåmindelse":"Ny Besked",body:a.message,data:{type:a.type,roomId:t.id}})})).ok)throw new Error("Failed to send push notification")}catch(n){}}))),g("Beskeder sendt til alle beboere"),n("")}catch(t){f("Fejl ved afsendelse af beskeder: "+t.message)}finally{c(!1)}}else f("Beskeden kan ikke være tom")},disabled:o||!e.trim()&&!r,children:o?t.jsx(m,{size:24}):"Send Besked"})]}),t.jsx(w,{sx:{my:3}}),t.jsx(l,{variant:"body2",color:"text.secondary",children:"Push beskeder vil blive sendt til alle beboere der har installeret app'en og accepteret notifikationer. Andre beboere kan se beskederne når de åbner app'en."})]})};var Je={},Xe=i;Object.defineProperty(Je,"__esModule",{value:!0});var Qe=Je.default=void 0,Ze=Xe(ke()),et=t;Qe=Je.default=(0,Ze.default)((0,et.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");var tt={},at=i;Object.defineProperty(tt,"__esModule",{value:!0});var st=tt.default=void 0,nt=at(ke()),rt=t;st=tt.default=(0,nt.default)((0,rt.jsx)("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8m-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91"}),"RestartAlt");const it=()=>{const[e,n]=s.useState(!1),[r,i]=s.useState(""),[o,c]=s.useState(""),[d,u]=s.useState(null),[S,k]=s.useState(!1),[w,N]=s.useState(!1),B=async()=>{n(!0),i(""),c("");try{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59),s=ee(je,"purchases"),n=Z(s,ce("timestamp",">=",de.fromDate(t)),ce("timestamp","<=",de.fromDate(a))),r=(await ae(n)).docs.map((e=>({id:e.id,...e.data()}))),i={totalSales:0,productSales:{},roomSales:{}};r.forEach((e=>{i.totalSales+=e.amount,i.productSales[e.productName]||(i.productSales[e.productName]={quantity:0,total:0}),i.productSales[e.productName].quantity+=1,i.productSales[e.productName].total+=e.amount,i.roomSales[e.roomId]||(i.roomSales[e.roomId]={quantity:0,total:0}),i.roomSales[e.roomId].quantity+=1,i.roomSales[e.roomId].total+=e.amount})),u(i),c("Rapport genereret")}catch(e){i("Fejl ved generering af rapport")}finally{n(!1)}},K=async()=>{N(!0),i(""),c("");try{const e=he(je),t=ee(je,"rooms"),a=await ae(t);a.docs.forEach((t=>{const a=se(je,"rooms",t.id);e.update(a,{balance:0,lastReset:de.now()})}));const s=se(ee(je,"resets"));e.set(s,{timestamp:de.now(),type:"monthly",roomCount:a.size}),await e.commit(),c("Alle saldi er nulstillet"),k(!1),d&&B()}catch(e){i("Fejl ved nulstilling af saldi: "+e.message)}finally{N(!1)}},L=()=>t.jsxs(P,{open:S,onClose:()=>!w&&k(!1),children:[t.jsx(C,{children:"Bekræft Nulstilling"}),t.jsx(D,{children:t.jsx(I,{children:"Er du sikker på at du vil nulstille alle saldi? Denne handling kan ikke fortrydes. Det anbefales at generere en rapport først."})}),t.jsxs(M,{children:[t.jsx(x,{onClick:()=>k(!1),disabled:w,children:"Annuller"}),t.jsx(x,{onClick:K,color:"error",disabled:w,startIcon:w?t.jsx(m,{size:20}):t.jsx(st,{}),children:w?"Nulstiller...":"Nulstil Alle Saldi"})]})]});return t.jsxs(h,{sx:{p:3},children:[t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(l,{variant:"h6",children:"Månedlig Rapport"}),t.jsxs(a,{children:[t.jsx(x,{variant:"outlined",color:"error",startIcon:t.jsx(st,{}),onClick:()=>k(!0),disabled:e||w,sx:{mr:2},children:"Nulstil Saldi"}),t.jsx(x,{variant:"contained",onClick:B,disabled:e||w,children:"Generer Rapport"})]})]}),r&&t.jsx(p,{severity:"error",sx:{mb:2},children:r}),o&&t.jsx(p,{severity:"success",sx:{mb:2},children:o}),e&&t.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(m,{})}),d&&t.jsxs(a,{children:[t.jsx(f,{sx:{mb:3},children:t.jsxs(j,{children:[t.jsx(g,{children:t.jsxs(b,{children:[t.jsx(y,{children:"Produkt"}),t.jsx(y,{align:"right",children:"Antal"}),t.jsx(y,{align:"right",children:"Total (DKK)"})]})}),t.jsxs(v,{children:[Object.entries(d.productSales).map((([e,a])=>t.jsxs(b,{children:[t.jsx(y,{children:e}),t.jsx(y,{align:"right",children:a.quantity}),t.jsx(y,{align:"right",children:a.total})]},e))),t.jsxs(b,{children:[t.jsx(y,{sx:{fontWeight:"bold"},children:"Total"}),t.jsx(y,{align:"right",sx:{fontWeight:"bold"},children:Object.values(d.productSales).reduce(((e,t)=>e+t.quantity),0)}),t.jsx(y,{align:"right",sx:{fontWeight:"bold"},children:d.totalSales})]})]})]})}),t.jsx(x,{variant:"contained",color:"primary",startIcon:t.jsx(Qe,{}),onClick:()=>{if(!d)return;const e=[];e.push("Rapport for "+(new Date).toLocaleDateString("da-DK",{month:"long",year:"numeric"})),e.push(""),e.push("Produkt Salg"),e.push("Produkt,Antal,Total (DKK)"),Object.entries(d.productSales).forEach((([t,a])=>{e.push(`${t},${a.quantity},${a.total}`)})),e.push(""),e.push("Værelse Salg"),e.push("Værelse,Antal Køb,Total (DKK)"),Object.entries(d.roomSales).forEach((([t,a])=>{e.push(`${t},${a.quantity},${a.total}`)})),e.push(""),e.push(`Total Salg,${d.totalSales} DKK`);const t=e.join("\n"),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download=`salgsrapport_${(new Date).toISOString().slice(0,7)}.csv`,s.click()},fullWidth:!0,children:"Download CSV"})]}),t.jsx(L,{})]})};var ot={},lt=i;Object.defineProperty(ot,"__esModule",{value:!0});var ct=ot.default=void 0,dt=lt(ke()),ht=t;ct=ot.default=(0,dt.default)((0,ht.jsx)("path",{d:"M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m-8 4c0 .55-.45 1-1 1s-1-.45-1-1V8h2zm2-6c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2m4 6c0 .55-.45 1-1 1s-1-.45-1-1V8h2z"}),"ShoppingBag");var ut={},xt=i;Object.defineProperty(ut,"__esModule",{value:!0});var mt=ut.default=void 0,pt=xt(ke()),ft=t;mt=ut.default=(0,pt.default)((0,ft.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");var jt={},gt=i;Object.defineProperty(jt,"__esModule",{value:!0});var bt=jt.default=void 0,yt=gt(ke()),vt=t;bt=jt.default=(0,yt.default)((0,vt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m.88 15.76V19h-1.75v-1.29c-.74-.18-2.39-.77-3.02-2.96l1.65-.67c.06.22.58 2.09 2.4 2.09.93 0 1.98-.48 1.98-1.61 0-.96-.7-1.46-2.28-2.03-1.1-.39-3.35-1.03-3.35-3.31 0-.1.01-2.4 2.62-2.96V5h1.75v1.24c1.84.32 2.51 1.79 2.66 2.23l-1.58.67c-.11-.35-.59-1.34-1.9-1.34-.7 0-1.81.37-1.81 1.39 0 .95.86 1.31 2.64 1.9 2.4.83 3.01 2.05 3.01 3.45 0 2.63-2.5 3.13-3.02 3.22"}),"Paid");const St=()=>{const[e,n]=s.useState([]),[r,i]=s.useState(!0),[o,u]=s.useState(""),[x,f]=s.useState(!1),[j,g]=s.useState({total:0,count:0}),b=async()=>{try{const e=new Date;e.setHours(0,0,0,0);const t=ee(je,"purchases"),a=Z(t,ce("timestamp",">=",de.fromDate(e))),s=await ae(a);let n=0,r=0;s.forEach((e=>{const t=e.data();n+=t.amount,r++})),g({total:n,count:r})}catch(e){}},y=s.useCallback((async(e=!1)=>{try{e||i(!0),u(""),await Promise.all([(async()=>{const e=ee(je,"purchases"),t=Z(e,ue("timestamp","desc"),xe(5)),a=await ae(t),s=await Promise.all(a.docs.map((async e=>{var t;const a=e.data(),s=se(je,"rooms",a.roomId),n=(await ne(s)).data()||{};return{id:e.id,...a,occupantName:n.occupantName||"Ukendt beboer",timestamp:(null==(t=a.timestamp)?void 0:t.toDate())||new Date}})));n(s)})(),b()]),u("")}catch(t){u("Kunne ikke indlæse seneste køb")}finally{i(!1),f(!1)}}),[]);s.useEffect((()=>{y()}),[y]);return r?t.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(m,{})}):o?t.jsx(h,{sx:{p:3},children:t.jsx(p,{severity:"error",children:o})}):t.jsxs(h,{sx:{p:3},children:[t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(l,{variant:"h6",children:"Seneste Aktivitet"}),t.jsx(N,{title:"Opdater liste",children:t.jsx(c,{onClick:async()=>{f(!0),await y(!0)},disabled:x,sx:{animation:x?"spin 1s linear infinite":"none","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}},children:t.jsx(mt,{})})})]}),t.jsx(B,{sx:{mb:3,bgcolor:"#f8fafc"},children:t.jsx(K,{children:t.jsxs(d,{container:!0,spacing:2,alignItems:"center",children:[t.jsx(d,{item:!0,children:t.jsx(L,{sx:{bgcolor:"#4CAF50",width:56,height:56},children:t.jsx(bt,{sx:{fontSize:32}})})}),t.jsxs(d,{item:!0,xs:!0,children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Dagens Salg"}),t.jsx(l,{variant:"body2",color:"text.secondary",children:(new Date).toLocaleDateString("da-DK",{weekday:"long",day:"numeric",month:"long"})})]}),t.jsxs(d,{item:!0,children:[t.jsxs(l,{variant:"h4",component:"div",sx:{color:"#2E7D32"},children:[j.total," kr"]}),t.jsxs(l,{variant:"body2",color:"text.secondary",align:"right",children:[j.count," køb i dag"]})]})]})})}),t.jsx(l,{variant:"subtitle1",gutterBottom:!0,sx:{mb:2},children:"Seneste 5 Køb"}),0===e.length?t.jsx(l,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:"Ingen køb at vise"}):t.jsx(O,{children:e.map(((e,a)=>t.jsxs(A.Fragment,{children:[a>0&&t.jsx(w,{variant:"inset",component:"li"}),t.jsxs(z,{alignItems:"flex-start",children:[t.jsx(W,{children:t.jsx(L,{sx:{bgcolor:"#5A78FF"},children:t.jsx(ct,{})})}),t.jsx(E,{primary:t.jsxs(l,{component:"span",variant:"subtitle1",color:"text.primary",children:["Værelse ",e.roomId," - ",e.occupantName]}),secondary:t.jsxs(A.Fragment,{children:[t.jsxs(l,{component:"span",variant:"body2",color:"text.primary",children:[e.productName," - ",e.amount," kr"]})," — ",new Date(e.timestamp).toLocaleString("da-DK",{weekday:"long",hour:"2-digit",minute:"2-digit",day:"numeric",month:"long"})]})})]})]},e.id)))})]})},kt=()=>{const[e,n]=s.useState(""),[r,i]=s.useState(!0),[o,c]=s.useState(!1),[d,f]=s.useState(""),[j,g]=s.useState("");s.useEffect((()=>{(async()=>{try{const e=se(je,"settings","admin"),t=await ne(e);t.exists()&&n(t.data().mobilepayLink||"")}catch(e){f("Kunne ikke indlæse indstillinger")}finally{i(!1)}})()}),[]);return r?t.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(m,{})}):t.jsxs(h,{sx:{p:3},children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Admin Indstillinger"}),d&&t.jsx(p,{severity:"error",sx:{mb:2},children:d}),j&&t.jsx(p,{severity:"success",sx:{mb:2},children:j}),t.jsxs(a,{sx:{mt:3},children:[t.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:"MobilePay Link"}),t.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Dette link bruges når beboere skal betale via MobilePay. Formatet skal være et gyldigt MobilePay-link."}),t.jsx(u,{fullWidth:!0,label:"MobilePay Link",value:e,onChange:e=>n(e.target.value),placeholder:"f.eks. https://mobilepay.dk/box/...",sx:{mb:3}}),t.jsx(a,{sx:{display:"flex",justifyContent:"flex-end"},children:t.jsx(x,{variant:"contained",color:"primary",onClick:async()=>{if(e.trim()){c(!0),f(""),g("");try{const t=se(je,"settings","admin");await re(t,{mobilepayLink:e.trim(),lastUpdated:new Date}),g("Indstillinger gemt")}catch(t){f("Kunne ikke gemme indstillinger")}finally{c(!1)}}else f("MobilePay link kan ikke være tomt")},disabled:o,children:o?t.jsx(m,{size:24}):"Gem Ændringer"})})]})]})},wt=()=>{const[e,n]=s.useState(!1),[r,i]=s.useState(""),[o,c]=s.useState(""),[d,m]=s.useState(0),f=$(),j=()=>{"admin123"===r?(n(!0),c("")):c("Forkert adgangskode")};return e?t.jsxs(a,{sx:{minHeight:"100vh",bgcolor:"#f5f6fa",p:3},children:[t.jsxs(h,{sx:{mb:3,p:2},children:[t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(l,{variant:"h5",component:"h1",children:"Admin Panel"}),t.jsx(x,{variant:"outlined",color:"primary",onClick:()=>{n(!1),i(""),f("/")},children:"Log ud"})]}),t.jsxs(R,{value:d,onChange:(e,t)=>{m(t)},sx:{borderBottom:1,borderColor:"divider","& .MuiTabs-flexContainer":{flexWrap:"wrap"}},children:[t.jsx(V,{label:"Produkter"}),t.jsx(V,{label:"Beskeder"}),t.jsx(V,{label:"Rapporter"}),t.jsx(V,{label:"Seneste Køb"}),t.jsx(V,{label:"Indstillinger"})]})]}),t.jsxs(a,{sx:{mt:3},children:[0===d&&t.jsx(Ue,{}),1===d&&t.jsx(Ye,{}),2===d&&t.jsx(it,{}),3===d&&t.jsx(St,{}),4===d&&t.jsx(kt,{})]})]}):t.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:"#f5f6fa",p:2},children:t.jsxs(h,{elevation:3,sx:{p:4,width:"100%",maxWidth:400,display:"flex",flexDirection:"column",gap:2},children:[t.jsx(l,{variant:"h5",component:"h1",gutterBottom:!0,align:"center",children:"Admin Login"}),o&&t.jsx(p,{severity:"error",children:o}),t.jsx(u,{fullWidth:!0,type:"password",label:"Adgangskode",value:r,onChange:e=>i(e.target.value),onKeyPress:e=>"Enter"===e.key&&j()}),t.jsx(x,{variant:"contained",color:"primary",fullWidth:!0,onClick:j,sx:{mt:2},children:"Log ind"})]})})},Pt=()=>{var e;const[n,r]=s.useState(localStorage.getItem("selectedRoom")||""),[i,o]=s.useState(null),[c,d]=s.useState(!0);s.useEffect((()=>{if(n){localStorage.setItem("selectedRoom",n);const e=ee(je,"rooms"),t=Z(e,ce("roomId","==",n)),a=te(t,(e=>{e.empty||o(e.docs[0].data()),d(!1)}));return()=>a()}}),[n]);const u=e=>{r(e.target.value)};return n?c?t.jsx(a,{sx:{p:2,height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx(l,{children:"Loading..."})}):t.jsxs(a,{sx:{p:2,height:"100vh",display:"flex",flexDirection:"column",gap:2,pb:"env(safe-area-inset-bottom)"},children:[t.jsxs(l,{variant:"h5",component:"h1",children:["Hej Room ",n]}),t.jsxs(h,{elevation:2,sx:{p:2},children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Balance"}),t.jsxs(l,{variant:"h4",color:"primary",children:[(null==i?void 0:i.balance)||0," DKK"]})]}),(null==i?void 0:i.lastPurchase)&&t.jsxs(h,{elevation:2,sx:{p:2},children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Sidste køb"}),t.jsxs(l,{children:[i.lastPurchase.productName," - ",i.lastPurchase.amount," DKK"]}),t.jsx(l,{variant:"caption",color:"text.secondary",children:null==(e=i.lastPurchase.timestamp)?void 0:e.toDate().toLocaleString("da-DK")})]}),t.jsx(x,{variant:"contained",color:"primary",size:"large",fullWidth:!0,onClick:()=>{if(null==i?void 0:i.balance){const e=`mobilepay://send?phone=12345678&amount=${i.balance}&comment=Room ${n} Payment`;window.location.href=e}},disabled:!(null==i?void 0:i.balance),sx:{mt:"auto"},children:"Betal nu via MobilePay"})]}):t.jsxs(a,{sx:{p:2,height:"100vh",display:"flex",flexDirection:"column",gap:2},children:[t.jsx(l,{variant:"h5",component:"h1",gutterBottom:!0,children:"Vælg dit værelse"}),t.jsxs(_,{value:n,onChange:u,displayEmpty:!0,fullWidth:!0,children:[t.jsx(F,{value:"",disabled:!0,children:"Vælg værelse"}),Array.from({length:28},((e,t)=>t+601)).map((e=>t.jsx(F,{value:e.toString(),children:e},e)))]})]})};function Ct(){const e=H("(max-width:600px)");return t.jsx(G,{children:t.jsxs(U,{children:[t.jsx(Y,{path:"/admin",element:t.jsx(wt,{})}),t.jsx(Y,{path:"/",element:e?t.jsx(Pt,{}):t.jsx(fe,{}),children:!e&&t.jsxs(t.Fragment,{children:[t.jsx(Y,{index:!0,element:t.jsx(Le,{})}),t.jsx(Y,{path:"room/:roomId",element:t.jsx(Ge,{})})]})})]})})}me(document.getElementById("root")).render(t.jsx(s.StrictMode,{children:t.jsx(Ct,{})}));
