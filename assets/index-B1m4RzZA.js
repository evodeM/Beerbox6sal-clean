import{a as e,j as t,B as a,r,g as o,u as n,i as s,C as i,I as l,T as c,G as d,P as x,b as h,c as m,s as u,S as p}from"./vendor-mui-BP6mtJWY.js";import{O as f,u as g,a as b,H as v,R as j,b as y,N as w}from"./vendor-react-D1b6S2F-.js";import{i as k,g as S,e as P,q as I,c as C,o as M,a as B,d as A,b as F,u as W,s as D,f as R,h as z,j as L,l as N,w as E}from"./vendor-firebase-CYND_fnV.js";var O;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var V=e;O=V.createRoot,V.hydrateRoot;const T=()=>t.jsx(a,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"#1a1a1a"},children:t.jsx(a,{component:"main",sx:{flexGrow:1},children:t.jsx(f,{})})}),_=S(k({apiKey:"AIzaSyBfzh_QQFaKhGXLuVJXbSVkBuOZOvXLBRg",authDomain:"fridge6sal-5b0f6.firebaseapp.com",projectId:"fridge6sal-5b0f6",storageBucket:"fridge6sal-5b0f6.appspot.com",messagingSenderId:"1091624932154",appId:"1:1091624932154:web:b5e0e3d9c5c9b5e5d8e5c5"}));P(_).catch((e=>{"failed-precondition"===e.code||e.code}));const H=(e,t=[],a={})=>{const[o,n]=r.useState([]),[s,i]=r.useState(!0),l=r.useRef(new Map),{realtime:c=!1}=a;return r.useEffect((()=>{const a=I(C(_,e),...t),r=`${e}-${t.join("-")}`;l.current.has(r)&&(n(l.current.get(r)),i(!1));if(c){const e=M(a,(e=>{const t=[];e.forEach((e=>{t.push({id:e.id,...e.data()})})),n(t),l.current.set(r,t),i(!1)}));return()=>e()}(async()=>{try{const e=await B(a),t=[];e.forEach((e=>{t.push({id:e.id,...e.data()})})),n(t),l.current.set(r,t),i(!1)}catch(e){i(!1)}})()}),[e,t.join("-"),c]),{data:o,loading:s}};var K={},X={};const Y=o(n);var $;function q(){return $||($=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=Y}(X)),X}var G=s;Object.defineProperty(K,"__esModule",{value:!0});var Q=K.default=void 0,J=G(q()),U=t;Q=K.default=(0,J.default)((0,U.jsx)("path",{d:"M9.68 13.69 12 11.93l2.31 1.76-.88-2.85L15.75 9h-2.84L12 6.19 11.09 9H8.25l2.31 1.84zM20 10c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 2.03.76 3.87 2 5.28V23l6-2 6 2v-7.72c1.24-1.41 2-3.25 2-5.28m-8-6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6"}),"WorkspacePremium");var Z={},ee=s;Object.defineProperty(Z,"__esModule",{value:!0});var te=Z.default=void 0,ae=ee(q()),re=t;te=Z.default=(0,ae.default)((0,re.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings");const oe=()=>{const e=g(),{data:a,loading:o}=H("rooms",[],{realtime:!1}),n=r.useMemo((()=>Math.max(...a.map((e=>e.balance||0)))),[a]),s=r.useMemo((()=>a.reduce(((e,t)=>(e[t.id]=t,e)),{})),[a]),h=({roomId:a})=>{const r=s[a]||{occupantName:"",balance:0},o=r.balance===n&&r.balance>0;return t.jsxs(x,{elevation:3,sx:{p:3,height:"100%",cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#fff",borderRadius:"12px",transition:"all 0.2s ease-in-out",position:"relative","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 16px rgba(0,0,0,0.1)"}},onClick:()=>(t=>{e(`/room/${t}`)})(a),children:[o&&t.jsx(Q,{sx:{position:"absolute",top:-10,right:-10,color:"#ffd700",fontSize:"2rem",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))",transform:"rotate(12deg)"}}),t.jsx(c,{variant:"h4",component:"div",sx:{color:"#2c3e50",fontWeight:"bold",mb:1},children:a}),t.jsx(c,{variant:"body1",sx:{color:"#666",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"100%",px:2},children:r.occupantName||"Tomt værelse"})]})};return t.jsxs(i,{maxWidth:!1,sx:{py:3,px:{xs:2,sm:3},minHeight:"100vh",bgcolor:"#f5f6fa",position:"relative",overflow:"hidden"},children:[t.jsx(l,{onClick:()=>e("/admin"),sx:{position:"absolute",top:16,right:16,color:"#2c3e50",opacity:.7,"&:hover":{opacity:1}},children:t.jsx(te,{})}),t.jsx(c,{variant:"h3",component:"h1",align:"center",sx:{color:"#2c3e50",mb:1,fontWeight:"bold"},children:"DormDrinks 6.sal"}),t.jsx(c,{variant:"subtitle1",component:"div",align:"center",sx:{color:"#666",mb:4},children:"Beer, Soda & Beyond"}),t.jsx(d,{container:!0,spacing:2,sx:{width:"auto",mx:-1,mt:0},children:Array.from({length:28},((e,t)=>t+601)).map((e=>t.jsx(d,{item:!0,xs:6,sm:4,md:3,sx:{height:"100%"},children:t.jsx(h,{roomId:e.toString()})},e)))})]})};var ne={},se=s;Object.defineProperty(ne,"__esModule",{value:!0});var ie=ne.default=void 0,le=se(q()),ce=t;ie=ne.default=(0,le.default)((0,ce.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var de={},xe=s;Object.defineProperty(de,"__esModule",{value:!0});var he=de.default=void 0,me=xe(q()),ue=t;he=de.default=(0,me.default)((0,ue.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");const pe=async e=>{try{const t=A(_,"rooms",e),a=await F(t);return a.exists()?{id:a.id,...a.data()}:null}catch(t){throw t}},fe=async()=>{try{const e=C(_,"products"),t=await B(e);return t.docs.map((e=>({id:e.id,...e.data()})))}catch(e){throw e}},ge=async()=>{try{const e=C(_,"products");if((await B(e)).empty){const t=[{id:"beer",name:"Øl",price:7},{id:"soda",name:"Sodavand",price:5},{id:"snacks",name:"Snacks",price:10},{id:"water",name:"Vand",price:3}];for(const a of t)await z(A(e,a.id),{name:a.name,price:a.price})}for(let a=601;a<=628;a++){const e=A(_,"rooms",a.toString());(await F(e)).exists()||await z(e,{occupantName:"",balance:0,lastPurchase:null})}const t=A(_,"adminConfig","general");(await F(t)).exists()||await z(t,{mobilePayPhoneNumber:"",adminPassword:"admin123"})}catch(e){throw e}},be=[{id:"beer",name:"Øl",price:7},{id:"soda",name:"Sodavand",price:5},{id:"snacks",name:"Snacks",price:10},{id:"water",name:"Vand",price:3}],ve=()=>{var e,o;const{roomId:n}=b(),s=g(),[l,u]=r.useState({occupantName:"",balance:0}),[p,f]=r.useState(be),[v,j]=r.useState(!0);r.useEffect((()=>{(async()=>{try{await ge();const[e,t]=await Promise.all([pe(n),fe()]);u(e||{occupantName:"",balance:0}),f(t.length>0?t:be)}catch(e){f(be)}finally{j(!1)}})()}),[n]);const y=async e=>{try{await(async(e,t)=>{try{const a=A(_,"rooms",e);await W(a,t)}catch(a){throw a}})(n,{occupantName:e}),u((t=>({...t,occupantName:e})))}catch(t){}},w=async e=>{try{const t=p.find((t=>t.id===e));if(!t)return;const a=(l.balance||0)+t.price,r=new Date;u((e=>({...e,balance:a,lastPurchase:{productName:t.name,amount:t.price,timestamp:r}}))),await(async e=>{var t;try{const a=C(_,"purchases"),r={...e,timestamp:D()};await R(a,r);const o=A(_,"rooms",e.roomId),n=(null==(t=(await F(o)).data())?void 0:t.balance)||0;await W(o,{balance:n+e.amount,lastPurchase:{productName:e.productName,amount:e.amount,timestamp:D()}})}catch(a){throw a}})({roomId:n,productId:e,productName:t.name,amount:t.price})}catch(t){const e=await pe(n);u(e||{occupantName:"",balance:0})}};return t.jsxs(a,{sx:{bgcolor:"#f5f6fa",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[t.jsxs(i,{maxWidth:"sm",sx:{py:4,flex:1},children:[t.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:6},children:[t.jsxs(c,{variant:"h3",component:"h1",sx:{color:"#2c3e50",fontWeight:"bold",mb:2},children:["Værelse ",n]}),t.jsx(a,{sx:{position:"relative",width:"100%",maxWidth:300},children:t.jsx(h,{variant:"outlined",placeholder:"Klik for at tilføje beboer",value:l.occupantName,onChange:e=>y(e.target.value),sx:{width:"100%","& .MuiOutlinedInput-root":{fontSize:"1.2rem",textAlign:"center","& fieldset":{borderColor:"rgba(0,0,0,0.2)"},"&:hover fieldset":{borderColor:"#e74c3c"},"&.Mui-focused fieldset":{borderColor:"#e74c3c"},"& input":{textAlign:"center",color:"#2c3e50","&::placeholder":{color:"#666",opacity:.7}}}},InputProps:{endAdornment:t.jsx(he,{sx:{color:"#666",opacity:.7,mr:1,transition:"all 0.2s",".MuiOutlinedInput-root:hover &":{color:"#e74c3c",opacity:1}}})}})})]}),t.jsxs(x,{elevation:3,sx:{p:4,mb:4,textAlign:"center",bgcolor:l.balance>0?"#fff3e0":"white",borderRadius:3},children:[t.jsx(c,{variant:"h6",sx:{color:"#666",mb:1},children:"SALDO"}),t.jsxs(c,{variant:"h2",sx:{color:l.balance>0?"#e74c3c":"#2c3e50",fontWeight:"bold"},children:[null==(e=l.balance)?void 0:e.toFixed(2)," kr"]})]}),l.lastPurchase&&t.jsxs(x,{elevation:3,sx:{bgcolor:"white",p:3,mb:4,borderRadius:3},children:[t.jsx(c,{variant:"overline",sx:{color:"#666",display:"block",mb:1,fontSize:"0.85rem"},children:"SENESTE KØB"}),t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(c,{variant:"h6",sx:{color:"#2c3e50",fontWeight:"bold"},children:l.lastPurchase.productName}),t.jsxs(a,{sx:{textAlign:"right"},children:[t.jsxs(c,{sx:{color:"#e74c3c",fontSize:"1.1rem",fontWeight:"bold"},children:[null==(o=l.lastPurchase.amount)?void 0:o.toFixed(2)," kr"]}),t.jsx(c,{sx:{color:"#666",fontSize:"0.9rem"},children:(e=>{if(!e)return"";return(e instanceof Date?e:e.toDate()).toLocaleString("da-DK",{hour:"2-digit",minute:"2-digit"})})(l.lastPurchase.timestamp)})]})]})]}),t.jsx(d,{container:!0,spacing:2,children:p.map((e=>t.jsx(d,{item:!0,xs:6,children:t.jsxs(m,{fullWidth:!0,variant:"contained",onClick:()=>w(e.id),sx:{bgcolor:"#e74c3c",py:2,borderRadius:2,fontSize:"1.1rem",fontWeight:"bold",boxShadow:"0 2px 8px rgba(231,76,60,0.3)",display:"flex",flexDirection:"column","&:hover":{bgcolor:"#c0392b",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(231,76,60,0.4)"}},children:[t.jsx(a,{children:e.name}),t.jsxs(c,{variant:"body2",sx:{opacity:.9,fontSize:"0.9rem",fontWeight:"normal"},children:[e.price," kr"]})]})},e.id)))})]}),t.jsx(a,{sx:{p:2,borderTop:"1px solid rgba(0,0,0,0.1)",bgcolor:"white"},children:t.jsx(i,{maxWidth:"sm",children:t.jsx(m,{fullWidth:!0,variant:"text",onClick:()=>s("/"),startIcon:t.jsx(ie,{}),sx:{color:"#666",py:1.5,fontSize:"1rem","&:hover":{bgcolor:"rgba(0,0,0,0.05)",color:"#2c3e50"}},children:"Tilbage til oversigt"})})})]})},je=u(i)({minHeight:"100vh",backgroundColor:"#ffffff",color:"#333333",display:"flex",flexDirection:"column",padding:"16px",gap:"24px"}),ye=u(a)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px solid #e0e0e0"}),we=u(h)({"& .MuiInputBase-input":{color:"#333333",backgroundColor:"#f0f0f0",borderRadius:"4px",padding:"8px 12px"},"& .MuiInput-underline:before":{borderBottom:"none"},"& .MuiInput-underline:after":{borderBottom:"none"}}),ke=u(m)({backgroundColor:"#5BB9FD",color:"white",padding:"16px",borderRadius:"8px",fontSize:"16px",textTransform:"none",marginTop:"40px",marginBottom:"40px","&:hover":{backgroundColor:"#4999d6"}}),Se=u(x)({backgroundColor:"#f5f5f5",padding:"16px",borderRadius:"8px",marginBottom:"16px",boxShadow:"none",border:"1px solid #e0e0e0"}),Pe=u(c)({fontSize:"18px",fontWeight:500,marginBottom:"12px",color:"#333333"}),Ie=()=>{var e;const[o,n]=r.useState({occupantName:"",balance:0,lastPurchase:null,recentPurchases:[]}),[s,i]=r.useState(localStorage.getItem("selectedRoom")),[l,d]=r.useState(!0),[x,m]=r.useState(null),u=e=>{if(!e)return"";return(e instanceof Date?e:e.toDate()).toLocaleString("da-DK",{hour:"2-digit",minute:"2-digit"})};r.useEffect((()=>{(async()=>{if(s)try{d(!0);const e=await pe(s),t=C(_,"rooms",s,"purchases"),a=I(t,L("timestamp","desc"),N(5)),r=await B(a),o=[];r.forEach((e=>{const t=e.data();o.push({id:e.id,...t,timestamp:t.timestamp})}));const i={...e,recentPurchases:o};n(i)}catch(e){m(e)}finally{d(!1)}})()}),[s]);const p=e=>{const t=e.target.value;i(t),localStorage.setItem("selectedRoom",t)},f=Array.from({length:28},((e,t)=>String(601+t)));return s?l?t.jsx(je,{children:t.jsx(c,{variant:"body1",sx:{textAlign:"center",mt:4},children:"Indlæser..."})}):t.jsxs(je,{children:[t.jsxs(ye,{children:[t.jsxs(c,{variant:"h6",sx:{color:"#333333"},children:["Værelse ",s]}),t.jsx(we,{variant:"standard",placeholder:"Beboernavn",value:(null==o?void 0:o.occupantName)||"",disabled:!0})]}),t.jsxs(a,{sx:{textAlign:"center",my:4},children:[t.jsx(c,{variant:"body1",sx:{mb:1,color:"#666666"},children:"Samlet saldo:"}),t.jsxs(c,{variant:"h4",sx:{color:"#333333"},children:[(null==(e=null==o?void 0:o.balance)?void 0:e.toFixed(2))||"0.00"," kr"]})]}),t.jsx(ke,{fullWidth:!0,variant:"contained",onClick:async()=>{const e=A(_,"adminConfig","general"),t=await F(e);if(t.exists()){const{mobilePayPhoneNumber:e}=t.data(),a=(null==o?void 0:o.balance)||0;window.location.href=`mobilepay://send?phone=${e}&amount=${a}&comment=Værelse ${s}`}},disabled:!(null==o?void 0:o.balance),children:"Betal med MobilePay"}),t.jsxs(Se,{children:[t.jsx(Pe,{children:"Seneste 5 køb"}),x&&t.jsxs(c,{variant:"body2",color:"error",children:["Fejl ved hentning af køb: ",x.message]}),o.lastPurchase&&t.jsxs(a,{sx:{mb:2,pb:2,borderBottom:"1px solid #e0e0e0"},children:[t.jsxs(c,{variant:"body2",sx:{display:"flex",justifyContent:"space-between",color:"#333333"},children:[t.jsxs("span",{children:["Seneste køb: ",o.lastPurchase.productName]}),t.jsxs("span",{children:["Pris: ",o.lastPurchase.amount," kr"]})]}),o.lastPurchase.timestamp&&t.jsx(c,{variant:"caption",sx:{display:"block",mt:.5,color:"#666666"},children:u(o.lastPurchase.timestamp)})]}),o.recentPurchases&&o.recentPurchases.length>0&&o.recentPurchases.map((e=>t.jsxs(a,{sx:{mb:2,pb:2,borderBottom:"1px solid #e0e0e0","&:last-child":{borderBottom:"none"}},children:[t.jsxs(c,{variant:"body2",sx:{display:"flex",justifyContent:"space-between",color:"#333333"},children:[t.jsxs("span",{children:["Produkt: ",e.productName]}),t.jsxs("span",{children:["Pris: ",e.amount," kr"]})]}),e.timestamp&&t.jsx(c,{variant:"caption",sx:{display:"block",mt:.5,color:"#666666"},children:u(e.timestamp)})]},e.id))),!o.lastPurchase&&(!o.recentPurchases||0===o.recentPurchases.length)&&t.jsx(c,{variant:"body2",sx:{color:"#666666"},children:"Ingen seneste køb"})]}),t.jsxs(Se,{children:[t.jsx(Pe,{children:"Påmindelser"}),t.jsx(c,{variant:"body2",sx:{color:"#333333"},children:"Husk køkkenmøde - Torsdag d. 15. juni"})]})]}):t.jsx(je,{children:t.jsxs(a,{sx:{textAlign:"center",mt:4},children:[t.jsx(c,{variant:"h5",gutterBottom:!0,children:"Velkommen"}),t.jsx(c,{gutterBottom:!0,sx:{mb:3,color:"#666666"},children:"Vælg dit værelse for at fortsætte"}),t.jsxs(h,{select:!0,fullWidth:!0,label:"Værelse",onChange:p,SelectProps:{native:!0},sx:{backgroundColor:"#f0f0f0",borderRadius:"8px","& .MuiInputBase-input":{color:"#333333"},"& .MuiInputLabel-root":{color:"#666666"}},children:[t.jsx("option",{value:"",children:"Vælg værelse"}),f.map((e=>t.jsx("option",{value:e,children:e},e)))]})]})})};var Ce={},Me=s;Object.defineProperty(Ce,"__esModule",{value:!0});var Be=Ce.default=void 0,Ae=Me(q()),Fe=t;Be=Ce.default=(0,Ae.default)((0,Fe.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");var We={},De=s;Object.defineProperty(We,"__esModule",{value:!0});var Re=We.default=void 0,ze=De(q()),Le=t;Re=We.default=(0,ze.default)((0,Le.jsx)("path",{d:"M18 1.01 8 1c-1.1 0-2 .9-2 2v3h2V5h10v14H8v-1H6v3c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99M10 15h2V8H5v2h3.59L3 15.59 4.41 17 10 11.41z"}),"AddToHomeScreen");var Ne={},Ee=s;Object.defineProperty(Ne,"__esModule",{value:!0});var Oe=Ne.default=void 0,Ve=Ee(q()),Te=t;Oe=Ne.default=(0,Ve.default)((0,Te.jsx)("path",{d:"M18 11v2h4v-2zm-2 6.61c.96.71 2.21 1.65 3.2 2.39.4-.53.8-1.07 1.2-1.6-.99-.74-2.24-1.68-3.2-2.4-.4.54-.8 1.08-1.2 1.61M20.4 5.6c-.4-.53-.8-1.07-1.2-1.6-.99.74-2.24 1.68-3.2 2.4.4.53.8 1.07 1.2 1.6.96-.72 2.21-1.65 3.2-2.4M4 9c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h1v4h2v-4h1l5 3V6L8 9zm11.5 3c0-1.33-.58-2.53-1.5-3.35v6.69c.92-.81 1.5-2.01 1.5-3.34"}),"Campaign");const _e=u(a)((({theme:e})=>({minHeight:"100vh",width:"100%",maxWidth:"100%",margin:0,padding:0,backgroundColor:"#f5f6fa",overflowX:"hidden",position:"relative"}))),He=u(a)((({theme:e})=>({position:"relative",padding:"48px 16px 24px 16px",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#fff",borderRadius:"0 0 24px 24px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",marginBottom:24,width:"100%",paddingTop:"calc(env(safe-area-inset-top) + 48px)","&::after":{content:'""',position:"absolute",bottom:0,left:"50%",transform:"translateX(-50%)",width:"40%",height:"4px",background:"linear-gradient(90deg, #5A78FF 0%, #83A4FF 100%)",borderRadius:"2px",opacity:.7}}))),Ke=u(a)((({theme:e})=>({padding:"0 16px",width:"100%",maxWidth:"100%",margin:"0 auto"}))),Xe=u(x)((({theme:e})=>({padding:"20px",borderRadius:"12px",backgroundColor:"#f8f9fa",marginTop:"16px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transition:"transform 0.2s ease-in-out","&:active":{transform:"scale(0.98)"}}))),Ye=u(x)((({theme:e})=>({padding:"16px",marginTop:"16px",marginBottom:"16px",borderRadius:"12px",backgroundColor:"#F8F9FF",border:"1px solid rgba(90, 120, 255, 0.1)"}))),$e=u(x)((({theme:e})=>({padding:"12px",marginBottom:"8px",borderRadius:"8px",backgroundColor:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"}))),qe=u(l)((({theme:e})=>({position:"absolute",right:"16px",top:"16px",backgroundColor:"rgba(255,255,255,0.9)","&:hover":{backgroundColor:"rgba(255,255,255,1)"}}))),Ge=u(x)((({theme:e})=>({position:"fixed",bottom:0,left:0,right:0,padding:"16px",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"#1976d2",color:"white",zIndex:1e3,borderRadius:"16px 16px 0 0"}))),Qe=()=>{var e;const[o,n]=r.useState({occupantName:"",balance:0,lastPurchase:null,recentPurchases:[]}),[s,i]=r.useState(localStorage.getItem("selectedRoom")),[d,x]=r.useState(!0),[u,f]=r.useState(null),[g,b]=r.useState(!1),[v,j]=r.useState({open:!1,message:"",severity:"info"}),[y,w]=r.useState(!1),[k,S]=r.useState(null),[P,F]=r.useState(!1);r.useState([]);const W=Array.from({length:28},((e,t)=>String(601+t))),D=e=>{const t=e.target.value;i(t),localStorage.setItem("selectedRoom",t)},R=e=>{if(!e)return"";return(e instanceof Date?e:e.toDate()).toLocaleString("da-DK",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit"})};r.useEffect((()=>{let e=null;return(async()=>{if(s)try{x(!0),await ge();const t=A(_,"rooms",s);e=M(t,(async e=>{if(e.exists()){const a={id:e.id,...e.data()},r=C(_,"purchases"),o=I(r,E("roomId","==",s));try{const e=await B(o),t=[];e.forEach((e=>{const a=e.data();t.push({id:e.id,...a,timestamp:a.timestamp})}));const r=t.sort(((e,t)=>{var a,r;return(null==(a=t.timestamp)?void 0:a.seconds)-(null==(r=e.timestamp)?void 0:r.seconds)})).slice(0,3),s={...a,recentPurchases:r};n(s)}catch(t){}}}),(e=>{f(e)}))}catch(t){f(t)}finally{x(!1)}})(),()=>{e&&e()}}),[s]);const z=async()=>{b(!0);try{const e=C(_,"purchases"),t=I(e,E("roomId","==",s)),a=await B(t),r=[];a.forEach((e=>{const t=e.data();r.push({id:e.id,...t,timestamp:t.timestamp})}));const o=r.sort(((e,t)=>{var a,r;return(null==(a=t.timestamp)?void 0:a.seconds)-(null==(r=e.timestamp)?void 0:r.seconds)})).slice(0,3);n((e=>({...e,recentPurchases:o}))),j({open:!0,message:"Data refreshed successfully",severity:"success"})}catch(e){j({open:!0,message:"Error refreshing data",severity:"error"})}finally{b(!1)}},L=()=>{window.location.href="https://qr.mobilepay.dk/p/02OeCN5J8MKzg-nbza0GUmlJ-24UKFkusa_TwL1txQBhbP2FDD2yRBUHtOX8WyxkZ-Qjxba4kzlIgqkDrA=="};r.useEffect((()=>{const e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;F(e)}),[]),r.useEffect((()=>{if(window.matchMedia("(display-mode: standalone)").matches)w(!1);else{if(!P){const e=e=>{e.preventDefault(),S(e),w(!0)};return window.addEventListener("beforeinstallprompt",e),()=>window.removeEventListener("beforeinstallprompt",e)}setTimeout((()=>{localStorage.getItem("iosInstallPrompted")||w(!0)}),2e3)}}),[P]);const N=()=>t.jsxs(a,{sx:{width:"100%",p:2},children:[t.jsxs(a,{sx:{mb:3,textAlign:"center"},children:[t.jsx(p,{variant:"text",width:120,height:24,sx:{mb:1,mx:"auto"}}),t.jsx(p,{variant:"text",width:80,height:32,sx:{mx:"auto"}})]}),t.jsx(p,{variant:"rounded",height:140,sx:{mb:3,borderRadius:3}}),t.jsx(p,{variant:"rounded",height:80,sx:{mb:3,borderRadius:2}}),t.jsxs(a,{sx:{mb:2},children:[t.jsx(p,{variant:"text",width:140,height:24,sx:{mb:2}}),[1,2,3].map((e=>t.jsx(p,{variant:"rounded",height:60,sx:{mb:1,borderRadius:1}},e)))]})]});return s?!o||d?t.jsx(_e,{children:t.jsx(He,{children:t.jsx(N,{})})}):u?t.jsx(_e,{children:t.jsxs(a,{sx:{textAlign:"center",mt:4},children:[t.jsx(c,{color:"error",children:"Error loading data. Please try again."}),t.jsx(m,{onClick:()=>window.location.reload(),sx:{mt:2},children:"Reload"})]})}):t.jsxs(_e,{onTouchStart:async e=>{const t=e.touches[0].clientY,a=e=>{e.touches[0].clientY-t>100&&0===window.scrollY&&(z(),document.removeEventListener("touchmove",a))};document.addEventListener("touchmove",a),document.addEventListener("touchend",(()=>{document.removeEventListener("touchmove",a)}),{once:!0})},children:[t.jsxs(He,{children:[t.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",zIndex:1,width:"100%",mt:"env(safe-area-inset-top)"},children:[t.jsx(c,{variant:"subtitle1",sx:{color:"#5A78FF",fontWeight:500,letterSpacing:"0.2px",mb:.5,background:"linear-gradient(90deg, #5A78FF 0%, #83A4FF 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:o.occupantName||"Ingen beboer"}),t.jsx(c,{variant:"h4",sx:{fontWeight:800,color:"#2c3e50",letterSpacing:"-0.5px"},children:s})]}),t.jsx(qe,{onClick:z,disabled:g,sx:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",color:"#5A78FF","&:hover":{backgroundColor:"rgba(90, 120, 255, 0.08)"}},children:t.jsx(Be,{sx:{animation:g?"spin 1s linear infinite":"none",transition:"transform 0.2s ease"}})})]}),t.jsxs(Ke,{children:[t.jsxs(Xe,{elevation:3,onClick:L,children:[t.jsx(c,{variant:"h6",sx:{mb:1,color:"#333"},children:"Køb i alt"}),t.jsxs(c,{variant:"h4",sx:{mb:2,color:o.balance>0?"#e74c3c":"#2ecc71"},children:[null==(e=o.balance)?void 0:e.toFixed(2)," kr"]}),t.jsx(m,{variant:"contained",fullWidth:!0,onClick:L,sx:{backgroundColor:"#5A78FF","&:hover":{backgroundColor:"#4A61D1"},py:1.5,borderRadius:2,textTransform:"none",fontSize:"1.1rem"},children:"Betal med MobilePay"})]}),t.jsx(Ye,{elevation:0,children:t.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[t.jsx(Oe,{sx:{color:"#5A78FF",mt:.5}}),t.jsxs(a,{children:[t.jsx(c,{variant:"subtitle1",sx:{fontWeight:500,mb:.5,color:"#2c3e50"},children:"Beskeder"}),t.jsx(c,{variant:"body2",sx:{color:"#666"},children:"Ingen nye beskeder"})]})]})}),t.jsxs(a,{sx:{mt:2,mb:2},children:[t.jsx(c,{variant:"subtitle1",sx:{mb:1,color:"#666",fontWeight:500},children:"Seneste køb"}),o.recentPurchases.map((e=>t.jsxs($e,{sx:{py:1,px:2,mb:.5,backgroundColor:"#f8f9ff",borderRadius:1},children:[t.jsxs(a,{sx:{display:"flex",alignItems:"baseline",gap:1},children:[t.jsx(c,{variant:"body2",sx:{fontWeight:500},children:e.productName}),t.jsx(c,{variant:"caption",color:"text.secondary",children:R(e.timestamp)})]}),t.jsxs(c,{variant:"body2",color:"primary",sx:{fontWeight:500},children:[e.amount.toFixed(2)," kr"]})]},e.id))),0===o.recentPurchases.length&&t.jsx(c,{variant:"caption",color:"text.secondary",sx:{display:"block",textAlign:"center"},children:"Ingen køb endnu"})]})]}),y&&t.jsxs(Ge,{elevation:3,children:[t.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:2,flex:1},children:[t.jsx(Re,{sx:{mt:.5}}),P?t.jsxs(a,{children:[t.jsx(c,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Føj til hjemmeskærm"}),t.jsxs(c,{variant:"body2",sx:{display:"flex",alignItems:"center",mb:.5},children:["1. Tryk på 'Del' ikonet ",t.jsx("span",{style:{fontSize:"1.4em",marginLeft:"8px",color:"#4CAF50"},children:"⎙"})]}),t.jsxs(c,{variant:"body2",sx:{display:"flex",alignItems:"center"},children:["2. Scroll ned og vælg ",t.jsx("span",{style:{fontWeight:"bold",marginLeft:"4px",color:"#4CAF50"},children:"'Føj til hjemmeskærm'"})]})]}):t.jsx(c,{children:"Føj til hjemmeskærm for hurtig adgang"})]}),t.jsxs(a,{children:[t.jsx(l,{color:"inherit",onClick:()=>{P&&localStorage.setItem("iosInstallPrompted","true"),w(!1)},sx:{mr:1},children:"✕"}),!P&&t.jsx(m,{variant:"contained",color:"inherit",onClick:async()=>{P?(localStorage.setItem("iosInstallPrompted","true"),w(!1)):k&&(k.prompt(),await k.userChoice,S(null),w(!1))},sx:{color:"#1976d2",backgroundColor:"white","&:hover":{backgroundColor:"#f5f5f5"}},children:"Installer"})]})]})]}):t.jsx(_e,{children:t.jsxs(a,{sx:{textAlign:"center",mt:4},children:[t.jsx(c,{variant:"h4",gutterBottom:!0,children:"Velkommen"}),t.jsx(c,{variant:"h6",gutterBottom:!0,sx:{mb:2,color:"#666666"},children:"til din personlige oversigt"}),t.jsx(c,{sx:{mb:4,color:"#666666"},children:"Vælg dit værelse for at komme i gang. Dette er en engangskonfiguration."}),t.jsxs(h,{select:!0,fullWidth:!0,label:"Vælg dit værelse",onChange:D,SelectProps:{native:!0},sx:{backgroundColor:"#f0f0f0",borderRadius:"8px","& .MuiInputBase-input":{color:"#333333",fontSize:"1.1rem",padding:"16px"},"& .MuiInputLabel-root":{color:"#666666",fontSize:"1.1rem"}},children:[t.jsx("option",{value:"",children:"Vælg værelse"}),W.map((e=>t.jsx("option",{value:e,children:e},e)))]}),t.jsx(c,{variant:"caption",sx:{display:"block",mt:2,color:"#666666"},children:"Bemærk: Dette valg gemmes til fremtidige besøg"})]})})},Je=()=>{const e=g(),[a,o]=r.useState(!0);return r.useEffect((()=>{(()=>{const t=navigator.userAgent||navigator.vendor||window.opera,a=/iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(t),r=window.innerWidth<=768,n="ontouchstart"in window||navigator.maxTouchPoints>0;e(a||r&&n?"/enhanced-mobile":"/",{replace:!0}),o(!1)})()}),[e]),a?t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",flexDirection:"column",gap:"1rem",padding:"1rem",textAlign:"center"},children:[t.jsx("div",{children:"Indlæser..."}),t.jsx("div",{style:{fontSize:"0.875rem",color:"#666"},children:"Omdirigerer til den rigtige visning..."})]}):null};function Ue(){return t.jsx(v,{children:t.jsxs(j,{children:[t.jsx(y,{path:"/detect",element:t.jsx(Je,{})}),t.jsx(y,{path:"/PWAVIEW",element:t.jsx(Ie,{})}),t.jsx(y,{path:"/enhanced-mobile",element:t.jsx(Qe,{})}),t.jsxs(y,{path:"/",element:t.jsx(T,{}),children:[t.jsx(y,{index:!0,element:t.jsx(oe,{})}),t.jsx(y,{path:"room/:roomId",element:t.jsx(ve,{})})]}),t.jsx(y,{path:"*",element:t.jsx(w,{to:"/detect",replace:!0})})]})})}O(document.getElementById("root")).render(t.jsx(r.StrictMode,{children:t.jsx(Ue,{})}));
