import{a as e,j as t,B as a,r as n,g as s,u as r,i as o,C as i,T as l,b as c,G as d,P as x,c as h,s as m,I as u,d as p,A as f,e as j,f as g,h as b,k as v,l as y,m as k,F as S,S as w,D as C,n as I,o as P,p as D,q as M,t as B,v as A,w as F,x as N,y as W,L as E,z as L,E as z,H as R,J as O,K as V,M as T,N as H,O as K}from"./vendor-mui-Dzhbmi1f.js";import{O as _,u as $,a as q,H as Y,R as U,b as G,N as J}from"./vendor-react-7mZx9QNg.js";import{i as X,g as Q,e as Z,S as ee,q as te,c as ae,o as ne,a as se,d as re,b as oe,u as ie,s as le,f as ce,h as de,j as xe,l as he,w as me,T as ue,k as pe}from"./vendor-firebase-RzwFv1Em.js";var fe;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var je=e;fe=je.createRoot,je.hydrateRoot;const ge=()=>t.jsx(a,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",bgcolor:"#1a1a1a"},children:t.jsx(a,{component:"main",sx:{flexGrow:1},children:t.jsx(_,{})})}),be=Q(X({apiKey:void 0,authDomain:void 0,projectId:void 0,storageBucket:void 0,messagingSenderId:void 0,appId:void 0}));Z(be,{cacheSizeBytes:ee}).catch((e=>{"failed-precondition"===e.code||e.code}));const ve=(e,t=[],a={})=>{const[s,r]=n.useState([]),[o,i]=n.useState(!0),l=n.useRef(new Map),{realtime:c=!1}=a;return n.useEffect((()=>{const a=te(ae(be,e),...t),n=`${e}-${t.join("-")}`;l.current.has(n)&&(r(l.current.get(n)),i(!1));if(c){const e=ne(a,(e=>{const t=[];e.forEach((e=>{t.push({id:e.id,...e.data()})})),r(t),l.current.set(n,t),i(!1)}));return()=>e()}(async()=>{try{const e=await se(a),t=[];e.forEach((e=>{t.push({id:e.id,...e.data()})})),r(t),l.current.set(n,t),i(!1)}catch(e){i(!1)}})()}),[e,t.join("-"),c]),{data:s,loading:o}};var ye={},ke={};const Se=s(r);var we;function Ce(){return we||(we=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=Se}(ke)),ke}var Ie=o;Object.defineProperty(ye,"__esModule",{value:!0});var Pe=ye.default=void 0,De=Ie(Ce()),Me=t;Pe=ye.default=(0,De.default)((0,Me.jsx)("path",{d:"M9.68 13.69 12 11.93l2.31 1.76-.88-2.85L15.75 9h-2.84L12 6.19 11.09 9H8.25l2.31 1.84zM20 10c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 2.03.76 3.87 2 5.28V23l6-2 6 2v-7.72c1.24-1.41 2-3.25 2-5.28m-8-6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6"}),"WorkspacePremium");var Be={},Ae=o;Object.defineProperty(Be,"__esModule",{value:!0});var Fe=Be.default=void 0,Ne=Ae(Ce()),We=t;Fe=Be.default=(0,Ne.default)((0,We.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings");const Ee=()=>{const e=$(),{data:s,loading:r}=ve("rooms",[],{realtime:!1}),o=n.useMemo((()=>Math.max(...s.map((e=>e.balance||0)))),[s]),h=n.useMemo((()=>s.reduce(((e,t)=>(e[t.id]=t,e)),{})),[s]),m=({roomId:a})=>{const n=h[a]||{occupantName:"",balance:0},s=n.balance===o&&n.balance>0;return t.jsxs(x,{elevation:3,sx:{p:3,height:"100%",cursor:"pointer",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#fff",borderRadius:"12px",transition:"all 0.2s ease-in-out",position:"relative","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 16px rgba(0,0,0,0.1)"}},onClick:()=>(t=>{e(`/room/${t}`)})(a),children:[s&&t.jsx(Pe,{sx:{position:"absolute",top:-10,right:-10,color:"#ffd700",fontSize:"2rem",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))",transform:"rotate(12deg)"}}),t.jsx(l,{variant:"h4",component:"div",sx:{color:"#2c3e50",fontWeight:"bold",mb:1},children:a}),t.jsx(l,{variant:"body1",sx:{color:"#666",textAlign:"center",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"100%",px:2},children:n.occupantName||"Tomt værelse"})]})};return t.jsxs(i,{maxWidth:!1,sx:{py:{xs:1,sm:3},px:{xs:2,sm:3},minHeight:"100vh",bgcolor:"#f5f6fa",position:"relative",overflow:"hidden",display:"flex",flexDirection:"column"},children:[t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:{xs:1,sm:4},mt:{xs:0,sm:2},position:"relative"},children:[t.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",width:"100%",position:"relative"},children:[t.jsx(l,{variant:"h4",component:"h1",sx:{color:"#2c3e50",mb:.5,fontWeight:"bold",width:"100%",fontSize:{xs:"1.5rem",sm:"2rem"}},children:"DormDrinks 6.sal"}),t.jsx(l,{variant:"subtitle1",component:"div",sx:{color:"#666",fontSize:{xs:"0.875rem",sm:"1rem"}},children:"Beer, Soda & Beyond"})]}),t.jsx(a,{sx:{position:"absolute",top:"50%",right:0,transform:"translateY(-50%)"},children:t.jsx(c,{variant:"contained",color:"primary",size:"small",startIcon:t.jsx(Fe,{}),onClick:()=>{e("/admin")},sx:{minWidth:{xs:"auto",sm:"100px"},px:{xs:1,sm:2}},children:"Admin"})})]}),t.jsx(d,{container:!0,spacing:2,sx:{flexGrow:1,overflow:"auto"},children:Array.from({length:28},((e,t)=>t+601)).map((e=>t.jsx(d,{item:!0,xs:6,sm:4,md:3,sx:{height:"100%"},children:t.jsx(m,{roomId:e.toString()})},e)))})]})};var Le={},ze=o;Object.defineProperty(Le,"__esModule",{value:!0});var Re=Le.default=void 0,Oe=ze(Ce()),Ve=t;Re=Le.default=(0,Oe.default)((0,Ve.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var Te={},He=o;Object.defineProperty(Te,"__esModule",{value:!0});var Ke=Te.default=void 0,_e=He(Ce()),$e=t;Ke=Te.default=(0,_e.default)((0,$e.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");const qe=async e=>{try{const t=re(be,"rooms",e),a=await oe(t);return a.exists()?{id:a.id,...a.data()}:null}catch(t){throw t}},Ye=async()=>{try{const e=ae(be,"products"),t=await se(e);return t.docs.map((e=>({id:e.id,...e.data()})))}catch(e){throw e}},Ue=async()=>{try{const e=ae(be,"products");if((await se(e)).empty){const t=[{id:"beer",name:"Øl",price:7},{id:"soda",name:"Sodavand",price:5},{id:"snacks",name:"Snacks",price:10},{id:"water",name:"Vand",price:3}];for(const a of t)await de(re(e,a.id),{name:a.name,price:a.price})}for(let a=601;a<=628;a++){const e=re(be,"rooms",a.toString());(await oe(e)).exists()||await de(e,{occupantName:"",balance:0,lastPurchase:null})}const t=re(be,"adminConfig","general");(await oe(t)).exists()||await de(t,{mobilePayPhoneNumber:"",adminPassword:"admin123"})}catch(e){throw e}},Ge=[{id:"beer",name:"Øl",price:7},{id:"soda",name:"Sodavand",price:5},{id:"snacks",name:"Snacks",price:10},{id:"water",name:"Vand",price:3}],Je=()=>{var e,s;const{roomId:r}=q(),o=$(),[m,u]=n.useState({occupantName:"",balance:0}),[p,f]=n.useState(Ge),[j,g]=n.useState(!0);n.useEffect((()=>{(async()=>{try{await Ue();const[e,t]=await Promise.all([qe(r),Ye()]);u(e||{occupantName:"",balance:0}),f(t.length>0?t:Ge)}catch(e){f(Ge)}finally{g(!1)}})()}),[r]);const b=async e=>{try{await(async(e,t)=>{try{const a=re(be,"rooms",e);await ie(a,t)}catch(a){throw a}})(r,{occupantName:e}),u((t=>({...t,occupantName:e})))}catch(t){}},v=async e=>{try{const t=p.find((t=>t.id===e));if(!t)return;const a=(m.balance||0)+t.price,n=new Date;u((e=>({...e,balance:a,lastPurchase:{productName:t.name,amount:t.price,timestamp:n}}))),await(async e=>{var t;try{const a=ae(be,"purchases"),n={...e,timestamp:le()};await ce(a,n);const s=re(be,"rooms",e.roomId),r=(null==(t=(await oe(s)).data())?void 0:t.balance)||0;await ie(s,{balance:r+e.amount,lastPurchase:{productName:e.productName,amount:e.amount,timestamp:le()}})}catch(a){throw a}})({roomId:r,productId:e,productName:t.name,amount:t.price})}catch(t){const e=await qe(r);u(e||{occupantName:"",balance:0})}};return t.jsxs(a,{sx:{bgcolor:"#f5f6fa",minHeight:"100vh",display:"flex",flexDirection:"column"},children:[t.jsxs(i,{maxWidth:"sm",sx:{py:4,flex:1},children:[t.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:6},children:[t.jsxs(l,{variant:"h3",component:"h1",sx:{color:"#2c3e50",fontWeight:"bold",mb:2},children:["Værelse ",r]}),t.jsx(a,{sx:{position:"relative",width:"100%",maxWidth:300},children:t.jsx(h,{variant:"outlined",placeholder:"Klik for at tilføje beboer",value:m.occupantName,onChange:e=>b(e.target.value),sx:{width:"100%","& .MuiOutlinedInput-root":{fontSize:"1.2rem",textAlign:"center","& fieldset":{borderColor:"rgba(0,0,0,0.2)"},"&:hover fieldset":{borderColor:"#e74c3c"},"&.Mui-focused fieldset":{borderColor:"#e74c3c"},"& input":{textAlign:"center",color:"#2c3e50","&::placeholder":{color:"#666",opacity:.7}}}},InputProps:{endAdornment:t.jsx(Ke,{sx:{color:"#666",opacity:.7,mr:1,transition:"all 0.2s",".MuiOutlinedInput-root:hover &":{color:"#e74c3c",opacity:1}}})}})})]}),t.jsxs(x,{elevation:3,sx:{p:4,mb:4,textAlign:"center",bgcolor:m.balance>0?"#fff3e0":"white",borderRadius:3},children:[t.jsx(l,{variant:"h6",sx:{color:"#666",mb:1},children:"SALDO"}),t.jsxs(l,{variant:"h2",sx:{color:m.balance>0?"#e74c3c":"#2c3e50",fontWeight:"bold"},children:[null==(e=m.balance)?void 0:e.toFixed(2)," kr"]})]}),m.lastPurchase&&t.jsxs(x,{elevation:3,sx:{bgcolor:"white",p:3,mb:4,borderRadius:3},children:[t.jsx(l,{variant:"overline",sx:{color:"#666",display:"block",mb:1,fontSize:"0.85rem"},children:"SENESTE KØB"}),t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(l,{variant:"h6",sx:{color:"#2c3e50",fontWeight:"bold"},children:m.lastPurchase.productName}),t.jsxs(a,{sx:{textAlign:"right"},children:[t.jsxs(l,{sx:{color:"#e74c3c",fontSize:"1.1rem",fontWeight:"bold"},children:[null==(s=m.lastPurchase.amount)?void 0:s.toFixed(2)," kr"]}),t.jsx(l,{sx:{color:"#666",fontSize:"0.9rem"},children:(e=>{if(!e)return"";return(e instanceof Date?e:e.toDate()).toLocaleString("da-DK",{hour:"2-digit",minute:"2-digit"})})(m.lastPurchase.timestamp)})]})]})]}),t.jsx(d,{container:!0,spacing:2,children:p.map((e=>t.jsx(d,{item:!0,xs:6,children:t.jsxs(c,{fullWidth:!0,variant:"contained",onClick:()=>v(e.id),sx:{bgcolor:"#e74c3c",py:2,borderRadius:2,fontSize:"1.1rem",fontWeight:"bold",boxShadow:"0 2px 8px rgba(231,76,60,0.3)",display:"flex",flexDirection:"column","&:hover":{bgcolor:"#c0392b",transform:"translateY(-2px)",boxShadow:"0 4px 12px rgba(231,76,60,0.4)"}},children:[t.jsx(a,{children:e.name}),t.jsxs(l,{variant:"body2",sx:{opacity:.9,fontSize:"0.9rem",fontWeight:"normal"},children:[e.price," kr"]})]})},e.id)))})]}),t.jsx(a,{sx:{p:2,borderTop:"1px solid rgba(0,0,0,0.1)",bgcolor:"white"},children:t.jsx(i,{maxWidth:"sm",children:t.jsx(c,{fullWidth:!0,variant:"text",onClick:()=>o("/"),startIcon:t.jsx(Re,{}),sx:{color:"#666",py:1.5,fontSize:"1rem","&:hover":{bgcolor:"rgba(0,0,0,0.05)",color:"#2c3e50"}},children:"Tilbage til oversigt"})})})]})},Xe=m(i)({minHeight:"100vh",backgroundColor:"#ffffff",color:"#333333",display:"flex",flexDirection:"column",padding:"16px",gap:"24px"}),Qe=m(a)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px solid #e0e0e0"}),Ze=m(h)({"& .MuiInputBase-input":{color:"#333333",backgroundColor:"#f0f0f0",borderRadius:"4px",padding:"8px 12px"},"& .MuiInput-underline:before":{borderBottom:"none"},"& .MuiInput-underline:after":{borderBottom:"none"}}),et=m(c)({backgroundColor:"#5BB9FD",color:"white",padding:"16px",borderRadius:"8px",fontSize:"16px",textTransform:"none",marginTop:"40px",marginBottom:"40px","&:hover":{backgroundColor:"#4999d6"}}),tt=m(x)({backgroundColor:"#f5f5f5",padding:"16px",borderRadius:"8px",marginBottom:"16px",boxShadow:"none",border:"1px solid #e0e0e0"}),at=m(l)({fontSize:"18px",fontWeight:500,marginBottom:"12px",color:"#333333"}),nt=()=>{var e;const[s,r]=n.useState({occupantName:"",balance:0,lastPurchase:null,recentPurchases:[]}),[o,i]=n.useState(localStorage.getItem("selectedRoom")),[c,d]=n.useState(!0),[x,m]=n.useState(null),u=e=>{if(!e)return"";return(e instanceof Date?e:e.toDate()).toLocaleString("da-DK",{hour:"2-digit",minute:"2-digit"})};n.useEffect((()=>{(async()=>{if(o)try{d(!0);const e=await qe(o),t=ae(be,"rooms",o,"purchases"),a=te(t,xe("timestamp","desc"),he(5)),n=await se(a),s=[];n.forEach((e=>{const t=e.data();s.push({id:e.id,...t,timestamp:t.timestamp})}));const i={...e,recentPurchases:s};r(i)}catch(e){m(e)}finally{d(!1)}})()}),[o]);const p=e=>{const t=e.target.value;i(t),localStorage.setItem("selectedRoom",t)},f=Array.from({length:28},((e,t)=>String(601+t)));return o?c?t.jsx(Xe,{children:t.jsx(l,{variant:"body1",sx:{textAlign:"center",mt:4},children:"Indlæser..."})}):t.jsxs(Xe,{children:[t.jsxs(Qe,{children:[t.jsxs(l,{variant:"h6",sx:{color:"#333333"},children:["Værelse ",o]}),t.jsx(Ze,{variant:"standard",placeholder:"Beboernavn",value:(null==s?void 0:s.occupantName)||"",disabled:!0})]}),t.jsxs(a,{sx:{textAlign:"center",my:4},children:[t.jsx(l,{variant:"body1",sx:{mb:1,color:"#666666"},children:"Samlet saldo:"}),t.jsxs(l,{variant:"h4",sx:{color:"#333333"},children:[(null==(e=null==s?void 0:s.balance)?void 0:e.toFixed(2))||"0.00"," kr"]})]}),t.jsx(et,{fullWidth:!0,variant:"contained",onClick:async()=>{const e=re(be,"adminConfig","general"),t=await oe(e);if(t.exists()){const{mobilePayPhoneNumber:e}=t.data(),a=(null==s?void 0:s.balance)||0;window.location.href=`mobilepay://send?phone=${e}&amount=${a}&comment=Værelse ${o}`}},disabled:!(null==s?void 0:s.balance),children:"Betal med MobilePay"}),t.jsxs(tt,{children:[t.jsx(at,{children:"Seneste 5 køb"}),x&&t.jsxs(l,{variant:"body2",color:"error",children:["Fejl ved hentning af køb: ",x.message]}),s.lastPurchase&&t.jsxs(a,{sx:{mb:2,pb:2,borderBottom:"1px solid #e0e0e0"},children:[t.jsxs(l,{variant:"body2",sx:{display:"flex",justifyContent:"space-between",color:"#333333"},children:[t.jsxs("span",{children:["Seneste køb: ",s.lastPurchase.productName]}),t.jsxs("span",{children:["Pris: ",s.lastPurchase.amount," kr"]})]}),s.lastPurchase.timestamp&&t.jsx(l,{variant:"caption",sx:{display:"block",mt:.5,color:"#666666"},children:u(s.lastPurchase.timestamp)})]}),s.recentPurchases&&s.recentPurchases.length>0&&s.recentPurchases.map((e=>t.jsxs(a,{sx:{mb:2,pb:2,borderBottom:"1px solid #e0e0e0","&:last-child":{borderBottom:"none"}},children:[t.jsxs(l,{variant:"body2",sx:{display:"flex",justifyContent:"space-between",color:"#333333"},children:[t.jsxs("span",{children:["Produkt: ",e.productName]}),t.jsxs("span",{children:["Pris: ",e.amount," kr"]})]}),e.timestamp&&t.jsx(l,{variant:"caption",sx:{display:"block",mt:.5,color:"#666666"},children:u(e.timestamp)})]},e.id))),!s.lastPurchase&&(!s.recentPurchases||0===s.recentPurchases.length)&&t.jsx(l,{variant:"body2",sx:{color:"#666666"},children:"Ingen seneste køb"})]}),t.jsxs(tt,{children:[t.jsx(at,{children:"Påmindelser"}),t.jsx(l,{variant:"body2",sx:{color:"#333333"},children:"Husk køkkenmøde - Torsdag d. 15. juni"})]})]}):t.jsx(Xe,{children:t.jsxs(a,{sx:{textAlign:"center",mt:4},children:[t.jsx(l,{variant:"h5",gutterBottom:!0,children:"Velkommen"}),t.jsx(l,{gutterBottom:!0,sx:{mb:3,color:"#666666"},children:"Vælg dit værelse for at fortsætte"}),t.jsxs(h,{select:!0,fullWidth:!0,label:"Værelse",onChange:p,SelectProps:{native:!0},sx:{backgroundColor:"#f0f0f0",borderRadius:"8px","& .MuiInputBase-input":{color:"#333333"},"& .MuiInputLabel-root":{color:"#666666"}},children:[t.jsx("option",{value:"",children:"Vælg værelse"}),f.map((e=>t.jsx("option",{value:e,children:e},e)))]})]})})};var st={},rt=o;Object.defineProperty(st,"__esModule",{value:!0});var ot=st.default=void 0,it=rt(Ce()),lt=t;ot=st.default=(0,it.default)((0,lt.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");var ct={},dt=o;Object.defineProperty(ct,"__esModule",{value:!0});var xt=ct.default=void 0,ht=dt(Ce()),mt=t;xt=ct.default=(0,ht.default)((0,mt.jsx)("path",{d:"M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2zm-9-2h10V8H12zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"AccountBalanceWallet");var ut={},pt=o;Object.defineProperty(ut,"__esModule",{value:!0});var ft=ut.default=void 0,jt=pt(Ce()),gt=t;ft=ut.default=(0,jt.default)((0,gt.jsx)("path",{d:"M18 1.01 8 1c-1.1 0-2 .9-2 2v3h2V5h10v14H8v-1H6v3c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99M10 15h2V8H5v2h3.59L3 15.59 4.41 17 10 11.41z"}),"AddToHomeScreen");var bt={},vt=o;Object.defineProperty(bt,"__esModule",{value:!0});var yt=bt.default=void 0,kt=vt(Ce()),St=t;yt=bt.default=(0,kt.default)((0,St.jsx)("path",{d:"M18 11v2h4v-2zm-2 6.61c.96.71 2.21 1.65 3.2 2.39.4-.53.8-1.07 1.2-1.6-.99-.74-2.24-1.68-3.2-2.4-.4.54-.8 1.08-1.2 1.61M20.4 5.6c-.4-.53-.8-1.07-1.2-1.6-.99.74-2.24 1.68-3.2 2.4.4.53.8 1.07 1.2 1.6.96-.72 2.21-1.65 3.2-2.4M4 9c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h1v4h2v-4h1l5 3V6L8 9zm11.5 3c0-1.33-.58-2.53-1.5-3.35v6.69c.92-.81 1.5-2.01 1.5-3.34"}),"Campaign");const wt=m(a)((({theme:e})=>({minHeight:"100vh",width:"100%",maxWidth:"100%",margin:0,padding:0,backgroundColor:"#f5f6fa",overflowX:"hidden",position:"relative"}))),Ct=m(a)((({theme:e})=>({position:"relative",padding:"48px 16px 24px 16px",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#fff",borderRadius:"0 0 24px 24px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.05)",marginBottom:24,width:"100%",paddingTop:"calc(env(safe-area-inset-top) + 48px)","&::after":{content:'""',position:"absolute",bottom:0,left:"50%",transform:"translateX(-50%)",width:"40%",height:"4px",background:"linear-gradient(90deg, #5A78FF 0%, #83A4FF 100%)",borderRadius:"2px",opacity:.7}}))),It=m(a)((({theme:e})=>({padding:"0 16px",width:"100%",maxWidth:"100%",margin:"0 auto"}))),Pt=m(x)((({theme:e})=>({padding:"20px",borderRadius:"12px",backgroundColor:"#f8f9fa",marginTop:"16px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",transition:"transform 0.2s ease-in-out","&:active":{transform:"scale(0.98)"}}))),Dt=m(x)((({theme:e})=>({padding:"16px",marginTop:"16px",marginBottom:"16px",borderRadius:"12px",backgroundColor:"#F8F9FF",border:"1px solid rgba(90, 120, 255, 0.1)"}))),Mt=m(x)((({theme:e})=>({padding:"12px",marginBottom:"8px",borderRadius:"8px",backgroundColor:"#ffffff",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"}))),Bt=m(u)((({theme:e})=>({position:"absolute",right:"16px",top:"16px",backgroundColor:"rgba(255,255,255,0.9)","&:hover":{backgroundColor:"rgba(255,255,255,1)"}}))),At=m(x)((({theme:e})=>({position:"fixed",bottom:0,left:0,right:0,padding:"16px",display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"#1976d2",color:"white",zIndex:1e3,borderRadius:"16px 16px 0 0"}))),Ft=()=>{var e;const[s,r]=n.useState({occupantName:"",balance:0,lastPurchase:null,recentPurchases:[]}),[o,i]=n.useState(localStorage.getItem("selectedRoom")),[d,x]=n.useState(!0),[m,f]=n.useState(null),[j,g]=n.useState(!1),[b,v]=n.useState({open:!1,message:"",severity:"info"}),[y,k]=n.useState(!1),[S,w]=n.useState(null),[C,I]=n.useState(!1);n.useState([]);const P=Array.from({length:28},((e,t)=>String(601+t))),D=e=>{const t=e.target.value;i(t),localStorage.setItem("selectedRoom",t)},M=e=>{if(!e)return"";return(e instanceof Date?e:e.toDate()).toLocaleString("da-DK",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit"})};n.useEffect((()=>{let e=null;return(async()=>{if(o)try{x(!0),await Ue();const t=re(be,"rooms",o);e=ne(t,(async e=>{if(e.exists()){const a={id:e.id,...e.data()},n=ae(be,"purchases"),s=te(n,me("roomId","==",o));try{const e=await se(s),t=[];e.forEach((e=>{const a=e.data();t.push({id:e.id,...a,timestamp:a.timestamp})}));const n=t.sort(((e,t)=>{var a,n;return(null==(a=t.timestamp)?void 0:a.seconds)-(null==(n=e.timestamp)?void 0:n.seconds)})).slice(0,3),o={...a,recentPurchases:n};r(o)}catch(t){}}}),(e=>{f(e)}))}catch(t){f(t)}finally{x(!1)}})(),()=>{e&&e()}}),[o]);const B=async()=>{g(!0);try{const e=ae(be,"purchases"),t=te(e,me("roomId","==",o)),a=await se(t),n=[];a.forEach((e=>{const t=e.data();n.push({id:e.id,...t,timestamp:t.timestamp})}));const s=n.sort(((e,t)=>{var a,n;return(null==(a=t.timestamp)?void 0:a.seconds)-(null==(n=e.timestamp)?void 0:n.seconds)})).slice(0,3);r((e=>({...e,recentPurchases:s}))),v({open:!0,message:"Data refreshed successfully",severity:"success"})}catch(e){v({open:!0,message:"Error refreshing data",severity:"error"})}finally{g(!1)}},A=()=>{window.location.href="https://qr.mobilepay.dk/p/02OeCN5J8MKzg-nbza0GUmlJ-24UKFkusa_TwL1txQBhbP2FDD2yRBUHtOX8WyxkZ-Qjxba4kzlIgqkDrA=="};n.useEffect((()=>{const e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;I(e)}),[]),n.useEffect((()=>{if(window.matchMedia("(display-mode: standalone)").matches)k(!1);else{if(!C){const e=e=>{e.preventDefault(),w(e),k(!0)};return window.addEventListener("beforeinstallprompt",e),()=>window.removeEventListener("beforeinstallprompt",e)}setTimeout((()=>{localStorage.getItem("iosInstallPrompted")||k(!0)}),2e3)}}),[C]);return o?d?t.jsx(wt,{children:t.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:t.jsx(p,{})})}):m?t.jsx(wt,{children:t.jsxs(a,{sx:{textAlign:"center",mt:4},children:[t.jsx(l,{color:"error",children:"Error loading data. Please try again."}),t.jsx(c,{onClick:()=>window.location.reload(),sx:{mt:2},children:"Reload"})]})}):t.jsxs(wt,{onTouchStart:async e=>{const t=e.touches[0].clientY,a=e=>{e.touches[0].clientY-t>100&&0===window.scrollY&&(B(),document.removeEventListener("touchmove",a))};document.addEventListener("touchmove",a),document.addEventListener("touchend",(()=>{document.removeEventListener("touchmove",a)}),{once:!0})},children:[t.jsxs(Ct,{children:[t.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",position:"relative",zIndex:1,width:"100%",mt:"env(safe-area-inset-top)"},children:[t.jsx(l,{variant:"subtitle1",sx:{color:"#5A78FF",fontWeight:500,letterSpacing:"0.2px",mb:.5,background:"linear-gradient(90deg, #5A78FF 0%, #83A4FF 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:s.occupantName||"Ingen beboer"}),t.jsx(l,{variant:"h4",sx:{fontWeight:800,color:"#2c3e50",letterSpacing:"-0.5px"},children:o})]}),t.jsx(Bt,{onClick:B,disabled:j,sx:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",color:"#5A78FF","&:hover":{backgroundColor:"rgba(90, 120, 255, 0.08)"}},children:t.jsx(ot,{sx:{animation:j?"spin 1s linear infinite":"none",transition:"transform 0.2s ease"}})})]}),t.jsxs(It,{children:[t.jsxs(Pt,{elevation:3,onClick:A,children:[t.jsx(l,{variant:"h6",sx:{mb:1,color:"#333"},children:"Køb i alt"}),t.jsxs(l,{variant:"h4",sx:{mb:2,color:s.balance>0?"#e74c3c":"#2ecc71"},children:[null==(e=s.balance)?void 0:e.toFixed(2)," kr"]}),t.jsx(c,{variant:"contained",fullWidth:!0,onClick:A,sx:{backgroundColor:"#5A78FF","&:hover":{backgroundColor:"#4A61D1"},py:1.5,borderRadius:2,textTransform:"none",fontSize:"1.1rem"},children:"Betal med MobilePay"})]}),t.jsx(Dt,{elevation:0,children:t.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[t.jsx(yt,{sx:{color:"#5A78FF",mt:.5}}),t.jsxs(a,{children:[t.jsx(l,{variant:"subtitle1",sx:{fontWeight:500,mb:.5,color:"#2c3e50"},children:"Beskeder"}),t.jsx(l,{variant:"body2",sx:{color:"#666"},children:"Ingen nye beskeder"})]})]})}),t.jsxs(a,{sx:{mt:2,mb:2},children:[t.jsx(l,{variant:"subtitle1",sx:{mb:1,color:"#666",fontWeight:500},children:"Seneste køb"}),s.recentPurchases.map((e=>t.jsxs(Mt,{sx:{py:1,px:2,mb:.5,backgroundColor:"#f8f9ff",borderRadius:1},children:[t.jsxs(a,{sx:{display:"flex",alignItems:"baseline",gap:1},children:[t.jsx(l,{variant:"body2",sx:{fontWeight:500},children:e.productName}),t.jsx(l,{variant:"caption",color:"text.secondary",children:M(e.timestamp)})]}),t.jsxs(l,{variant:"body2",color:"primary",sx:{fontWeight:500},children:[e.amount.toFixed(2)," kr"]})]},e.id))),0===s.recentPurchases.length&&t.jsx(l,{variant:"caption",color:"text.secondary",sx:{display:"block",textAlign:"center"},children:"Ingen køb endnu"})]})]}),y&&t.jsxs(At,{elevation:3,children:[t.jsxs(a,{sx:{display:"flex",alignItems:"flex-start",gap:2,flex:1},children:[t.jsx(ft,{sx:{mt:.5}}),C?t.jsxs(a,{children:[t.jsx(l,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Føj til hjemmeskærm"}),t.jsxs(l,{variant:"body2",sx:{display:"flex",alignItems:"center",mb:.5},children:["1. Tryk på 'Del' ikonet ",t.jsx("span",{style:{fontSize:"1.4em",marginLeft:"8px",color:"#4CAF50"},children:"⎙"})]}),t.jsxs(l,{variant:"body2",sx:{display:"flex",alignItems:"center"},children:["2. Scroll ned og vælg ",t.jsx("span",{style:{fontWeight:"bold",marginLeft:"4px",color:"#4CAF50"},children:"'Føj til hjemmeskærm'"})]})]}):t.jsx(l,{children:"Føj til hjemmeskærm for hurtig adgang"})]}),t.jsxs(a,{children:[t.jsx(u,{color:"inherit",onClick:()=>{C&&localStorage.setItem("iosInstallPrompted","true"),k(!1)},sx:{mr:1},children:"✕"}),!C&&t.jsx(c,{variant:"contained",color:"inherit",onClick:async()=>{C?(localStorage.setItem("iosInstallPrompted","true"),k(!1)):S&&(S.prompt(),await S.userChoice,w(null),k(!1))},sx:{color:"#1976d2",backgroundColor:"white","&:hover":{backgroundColor:"#f5f5f5"}},children:"Installer"})]})]})]}):t.jsx(wt,{children:t.jsxs(a,{sx:{textAlign:"center",mt:4},children:[t.jsx(l,{variant:"h4",gutterBottom:!0,children:"Velkommen"}),t.jsx(l,{variant:"h6",gutterBottom:!0,sx:{mb:2,color:"#666666"},children:"til din personlige oversigt"}),t.jsx(l,{sx:{mb:4,color:"#666666"},children:"Vælg dit værelse for at komme i gang. Dette er en engangskonfiguration."}),t.jsxs(h,{select:!0,fullWidth:!0,label:"Vælg dit værelse",onChange:D,SelectProps:{native:!0},sx:{backgroundColor:"#f0f0f0",borderRadius:"8px","& .MuiInputBase-input":{color:"#333333",fontSize:"1.1rem",padding:"16px"},"& .MuiInputLabel-root":{color:"#666666",fontSize:"1.1rem"}},children:[t.jsx("option",{value:"",children:"Vælg værelse"}),P.map((e=>t.jsx("option",{value:e,children:e},e)))]}),t.jsx(l,{variant:"caption",sx:{display:"block",mt:2,color:"#666666"},children:"Bemærk: Dette valg gemmes til fremtidige besøg"})]})})},Nt=()=>{const[e,s]=n.useState([]),[r,o]=n.useState(!0),[i,d]=n.useState(""),[m,u]=n.useState(""),[S,w]=n.useState({});n.useEffect((()=>{C()}),[]);const C=async()=>{try{const e=ae(be,"products"),t=(await se(e)).docs.map((e=>({id:e.id,...e.data()})));s(t),w(t.reduce(((e,t)=>({...e,[t.id]:{name:t.name,price:t.price}})),{}))}catch(e){d("Fejl ved indlæsning af produkter")}finally{o(!1)}},I=(e,t,a)=>{w((n=>({...n,[e]:{...n[e],[t]:"price"===t?Number(a):a}})))};return r?t.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(p,{})}):t.jsxs(x,{sx:{p:3},children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Produkt Administration"}),i&&t.jsx(f,{severity:"error",sx:{mb:2},children:i}),m&&t.jsx(f,{severity:"success",sx:{mb:2},children:m}),t.jsx(j,{children:t.jsxs(g,{children:[t.jsx(b,{children:t.jsxs(v,{children:[t.jsx(y,{children:"Produkt"}),t.jsx(y,{children:"Pris (DKK)"})]})}),t.jsx(k,{children:e.map((e=>{var a,n;return t.jsxs(v,{children:[t.jsx(y,{children:t.jsx(h,{fullWidth:!0,value:(null==(a=S[e.id])?void 0:a.name)||"",onChange:t=>I(e.id,"name",t.target.value)})}),t.jsx(y,{children:t.jsx(h,{type:"number",value:(null==(n=S[e.id])?void 0:n.price)||0,onChange:t=>I(e.id,"price",t.target.value),InputProps:{inputProps:{min:0,step:1}}})})]},e.id)}))})]})}),t.jsx(a,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:t.jsx(c,{variant:"contained",color:"primary",onClick:async()=>{o(!0),d("");try{await Promise.all(e.map((async e=>{const t=S[e.id];!t||t.name===e.name&&t.price===e.price||await ie(re(be,"products",e.id),{name:t.name,price:t.price})}))),u("Produkter opdateret"),C()}catch(t){d("Fejl ved opdatering af produkter")}finally{o(!1)}},disabled:r,children:"Gem Ændringer"})})]})},Wt=()=>{const[e,s]=n.useState(""),[r,o]=n.useState(!1),[i,d]=n.useState(!1),[m,u]=n.useState(""),[j,g]=n.useState("");return t.jsxs(x,{sx:{p:3},children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Send Beskeder"}),m&&t.jsx(f,{severity:"error",sx:{mb:2},children:m}),j&&t.jsx(f,{severity:"success",sx:{mb:2},children:j}),t.jsx(a,{sx:{mb:3},children:t.jsx(S,{control:t.jsx(w,{checked:r,onChange:e=>o(e.target.checked),name:"endOfMonth"}),label:"Månedlig betalingspåmindelse"})}),t.jsx(h,{fullWidth:!0,multiline:!0,rows:4,label:"Besked",value:e,onChange:e=>s(e.target.value),disabled:r,sx:{mb:3}}),t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(l,{variant:"body2",color:"text.secondary",children:r?"Der vil blive sendt en påmindelse til alle beboere med deres aktuelle saldo.":"Skriv en besked der skal sendes til alle beboere."}),t.jsx(c,{variant:"contained",color:"primary",onClick:async()=>{if(e.trim()||r){d(!0),u(""),g("");try{const t=(await se(ae(be,"rooms"))).docs.map((e=>({id:e.id,...e.data()}))),a=ae(be,"fcmTokens"),n=(await se(a)).docs.reduce(((e,t)=>{const a=t.data();return a.roomId&&a.token&&(e[a.roomId]||(e[a.roomId]=[]),e[a.roomId].push(a.token)),e}),{});await Promise.all(t.map((async t=>{const a={roomId:t.id,message:r?`Hej ${t.occupantName||"beboer"}! Din saldo er ${t.balance} kr. Venligst betal inden månedens udgang.`:e,timestamp:new Date,read:!1,type:r?"payment":"announcement"};if(await ce(ae(be,"notifications"),a),n[t.id]&&n[t.id].length>0)try{if(!(await fetch("https://us-central1-dorm-sales-app.cloudfunctions.net/sendPushNotification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tokens:n[t.id],title:r?"Betalingspåmindelse":"Ny Besked",body:a.message,data:{type:a.type,roomId:t.id}})})).ok)throw new Error("Failed to send push notification")}catch(s){}}))),g("Beskeder sendt til alle beboere"),s("")}catch(t){u("Fejl ved afsendelse af beskeder: "+t.message)}finally{d(!1)}}else u("Beskeden kan ikke være tom")},disabled:i||!e.trim()&&!r,children:i?t.jsx(p,{size:24}):"Send Besked"})]}),t.jsx(C,{sx:{my:3}}),t.jsx(l,{variant:"body2",color:"text.secondary",children:"Push beskeder vil blive sendt til alle beboere der har installeret app'en og accepteret notifikationer. Andre beboere kan se beskederne når de åbner app'en."})]})};var Et={},Lt=o;Object.defineProperty(Et,"__esModule",{value:!0});var zt=Et.default=void 0,Rt=Lt(Ce()),Ot=t;zt=Et.default=(0,Rt.default)((0,Ot.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");var Vt={},Tt=o;Object.defineProperty(Vt,"__esModule",{value:!0});var Ht=Vt.default=void 0,Kt=Tt(Ce()),_t=t;Ht=Vt.default=(0,Kt.default)((0,_t.jsx)("path",{d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6 0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93 0-4.42-3.58-8-8-8m-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34C4.9 8.79 4 10.79 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91"}),"RestartAlt");const $t=()=>{const[e,s]=n.useState(!1),[r,o]=n.useState(""),[i,d]=n.useState(""),[h,m]=n.useState(null),[u,S]=n.useState(!1),[w,C]=n.useState(!1),A=async()=>{s(!0),o(""),d("");try{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0,23,59,59),n=ae(be,"purchases"),s=te(n,me("timestamp",">=",ue.fromDate(t)),me("timestamp","<=",ue.fromDate(a))),r=(await se(s)).docs.map((e=>({id:e.id,...e.data()}))),o={totalSales:0,productSales:{},roomSales:{}};r.forEach((e=>{o.totalSales+=e.amount,o.productSales[e.productName]||(o.productSales[e.productName]={quantity:0,total:0}),o.productSales[e.productName].quantity+=1,o.productSales[e.productName].total+=e.amount,o.roomSales[e.roomId]||(o.roomSales[e.roomId]={quantity:0,total:0}),o.roomSales[e.roomId].quantity+=1,o.roomSales[e.roomId].total+=e.amount})),m(o),d("Rapport genereret")}catch(e){o("Fejl ved generering af rapport")}finally{s(!1)}},F=async()=>{C(!0),o(""),d("");try{const e=pe(be),t=ae(be,"rooms"),a=await se(t);a.docs.forEach((t=>{const a=re(be,"rooms",t.id);e.update(a,{balance:0,lastReset:ue.now()})}));const n=re(ae(be,"resets"));e.set(n,{timestamp:ue.now(),type:"monthly",roomCount:a.size}),await e.commit(),d("Alle saldi er nulstillet"),S(!1),h&&A()}catch(e){o("Fejl ved nulstilling af saldi: "+e.message)}finally{C(!1)}},N=()=>t.jsxs(I,{open:u,onClose:()=>!w&&S(!1),children:[t.jsx(P,{children:"Bekræft Nulstilling"}),t.jsx(D,{children:t.jsx(M,{children:"Er du sikker på at du vil nulstille alle saldi? Denne handling kan ikke fortrydes. Det anbefales at generere en rapport først."})}),t.jsxs(B,{children:[t.jsx(c,{onClick:()=>S(!1),disabled:w,children:"Annuller"}),t.jsx(c,{onClick:F,color:"error",disabled:w,startIcon:w?t.jsx(p,{size:20}):t.jsx(Ht,{}),children:w?"Nulstiller...":"Nulstil Alle Saldi"})]})]});return t.jsxs(x,{sx:{p:3},children:[t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(l,{variant:"h6",children:"Månedlig Rapport"}),t.jsxs(a,{children:[t.jsx(c,{variant:"outlined",color:"error",startIcon:t.jsx(Ht,{}),onClick:()=>S(!0),disabled:e||w,sx:{mr:2},children:"Nulstil Saldi"}),t.jsx(c,{variant:"contained",onClick:A,disabled:e||w,children:"Generer Rapport"})]})]}),r&&t.jsx(f,{severity:"error",sx:{mb:2},children:r}),i&&t.jsx(f,{severity:"success",sx:{mb:2},children:i}),e&&t.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(p,{})}),h&&t.jsxs(a,{children:[t.jsx(j,{sx:{mb:3},children:t.jsxs(g,{children:[t.jsx(b,{children:t.jsxs(v,{children:[t.jsx(y,{children:"Produkt"}),t.jsx(y,{align:"right",children:"Antal"}),t.jsx(y,{align:"right",children:"Total (DKK)"})]})}),t.jsxs(k,{children:[Object.entries(h.productSales).map((([e,a])=>t.jsxs(v,{children:[t.jsx(y,{children:e}),t.jsx(y,{align:"right",children:a.quantity}),t.jsx(y,{align:"right",children:a.total})]},e))),t.jsxs(v,{children:[t.jsx(y,{sx:{fontWeight:"bold"},children:"Total"}),t.jsx(y,{align:"right",sx:{fontWeight:"bold"},children:Object.values(h.productSales).reduce(((e,t)=>e+t.quantity),0)}),t.jsx(y,{align:"right",sx:{fontWeight:"bold"},children:h.totalSales})]})]})]})}),t.jsx(c,{variant:"contained",color:"primary",startIcon:t.jsx(zt,{}),onClick:()=>{if(!h)return;const e=[];e.push("Rapport for "+(new Date).toLocaleDateString("da-DK",{month:"long",year:"numeric"})),e.push(""),e.push("Produkt Salg"),e.push("Produkt,Antal,Total (DKK)"),Object.entries(h.productSales).forEach((([t,a])=>{e.push(`${t},${a.quantity},${a.total}`)})),e.push(""),e.push("Værelse Salg"),e.push("Værelse,Antal Køb,Total (DKK)"),Object.entries(h.roomSales).forEach((([t,a])=>{e.push(`${t},${a.quantity},${a.total}`)})),e.push(""),e.push(`Total Salg,${h.totalSales} DKK`);const t=e.join("\n"),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(a),n.download=`salgsrapport_${(new Date).toISOString().slice(0,7)}.csv`,n.click()},fullWidth:!0,children:"Download CSV"})]}),t.jsx(N,{})]})};var qt={},Yt=o;Object.defineProperty(qt,"__esModule",{value:!0});var Ut=qt.default=void 0,Gt=Yt(Ce()),Jt=t;Ut=qt.default=(0,Gt.default)((0,Jt.jsx)("path",{d:"M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m-8 4c0 .55-.45 1-1 1s-1-.45-1-1V8h2zm2-6c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2m4 6c0 .55-.45 1-1 1s-1-.45-1-1V8h2z"}),"ShoppingBag");var Xt={},Qt=o;Object.defineProperty(Xt,"__esModule",{value:!0});var Zt=Xt.default=void 0,ea=Qt(Ce()),ta=t;Zt=Xt.default=(0,ea.default)((0,ta.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m.88 15.76V19h-1.75v-1.29c-.74-.18-2.39-.77-3.02-2.96l1.65-.67c.06.22.58 2.09 2.4 2.09.93 0 1.98-.48 1.98-1.61 0-.96-.7-1.46-2.28-2.03-1.1-.39-3.35-1.03-3.35-3.31 0-.1.01-2.4 2.62-2.96V5h1.75v1.24c1.84.32 2.51 1.79 2.66 2.23l-1.58.67c-.11-.35-.59-1.34-1.9-1.34-.7 0-1.81.37-1.81 1.39 0 .95.86 1.31 2.64 1.9 2.4.83 3.01 2.05 3.01 3.45 0 2.63-2.5 3.13-3.02 3.22"}),"Paid");const aa=()=>{const[e,s]=n.useState([]),[r,o]=n.useState(!0),[i,c]=n.useState(""),[h,m]=n.useState(!1),[j,g]=n.useState({total:0,count:0}),b=async()=>{try{const e=new Date;e.setHours(0,0,0,0);const t=ae(be,"purchases"),a=te(t,me("timestamp",">=",ue.fromDate(e))),n=await se(a);let s=0,r=0;n.forEach((e=>{const t=e.data();s+=t.amount,r++})),g({total:s,count:r})}catch(e){}},v=n.useCallback((async(e=!1)=>{try{e||o(!0),c(""),await Promise.all([(async()=>{const e=ae(be,"purchases"),t=te(e,xe("timestamp","desc"),he(5)),a=await se(t),n=await Promise.all(a.docs.map((async e=>{var t;const a=e.data(),n=re(be,"rooms",a.roomId),s=(await oe(n)).data()||{};return{id:e.id,...a,occupantName:s.occupantName||"Ukendt beboer",timestamp:(null==(t=a.timestamp)?void 0:t.toDate())||new Date}})));s(n)})(),b()]),c("")}catch(t){c("Kunne ikke indlæse seneste køb")}finally{o(!1),m(!1)}}),[]);n.useEffect((()=>{v()}),[v]);return r?t.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(p,{})}):i?t.jsx(x,{sx:{p:3},children:t.jsx(f,{severity:"error",children:i})}):t.jsxs(x,{sx:{p:3},children:[t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(l,{variant:"h6",children:"Seneste Aktivitet"}),t.jsx(A,{title:"Opdater liste",children:t.jsx(u,{onClick:async()=>{m(!0),await v(!0)},disabled:h,sx:{animation:h?"spin 1s linear infinite":"none","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}},children:t.jsx(ot,{})})})]}),t.jsx(F,{sx:{mb:3,bgcolor:"#f8fafc"},children:t.jsx(N,{children:t.jsxs(d,{container:!0,spacing:2,alignItems:"center",children:[t.jsx(d,{item:!0,children:t.jsx(W,{sx:{bgcolor:"#4CAF50",width:56,height:56},children:t.jsx(Zt,{sx:{fontSize:32}})})}),t.jsxs(d,{item:!0,xs:!0,children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Dagens Salg"}),t.jsx(l,{variant:"body2",color:"text.secondary",children:(new Date).toLocaleDateString("da-DK",{weekday:"long",day:"numeric",month:"long"})})]}),t.jsxs(d,{item:!0,children:[t.jsxs(l,{variant:"h4",component:"div",sx:{color:"#2E7D32"},children:[j.total," kr"]}),t.jsxs(l,{variant:"body2",color:"text.secondary",align:"right",children:[j.count," køb i dag"]})]})]})})}),t.jsx(l,{variant:"subtitle1",gutterBottom:!0,sx:{mb:2},children:"Seneste 5 Køb"}),0===e.length?t.jsx(l,{color:"text.secondary",sx:{p:2,textAlign:"center"},children:"Ingen køb at vise"}):t.jsx(E,{children:e.map(((e,a)=>t.jsxs(L.Fragment,{children:[a>0&&t.jsx(C,{variant:"inset",component:"li"}),t.jsxs(z,{alignItems:"flex-start",children:[t.jsx(R,{children:t.jsx(W,{sx:{bgcolor:"#5A78FF"},children:t.jsx(Ut,{})})}),t.jsx(O,{primary:t.jsxs(l,{component:"span",variant:"subtitle1",color:"text.primary",children:["Værelse ",e.roomId," - ",e.occupantName]}),secondary:t.jsxs(L.Fragment,{children:[t.jsxs(l,{component:"span",variant:"body2",color:"text.primary",children:[e.productName," - ",e.amount," kr"]})," — ",new Date(e.timestamp).toLocaleString("da-DK",{weekday:"long",hour:"2-digit",minute:"2-digit",day:"numeric",month:"long"})]})})]})]},e.id)))})]})},na=()=>{const[e,s]=n.useState(""),[r,o]=n.useState(!0),[i,d]=n.useState(!1),[m,u]=n.useState(""),[j,g]=n.useState("");n.useEffect((()=>{(async()=>{try{const e=re(be,"settings","admin"),t=await oe(e);t.exists()&&s(t.data().mobilepayLink||"")}catch(e){u("Kunne ikke indlæse indstillinger")}finally{o(!1)}})()}),[]);return r?t.jsx(a,{sx:{display:"flex",justifyContent:"center",p:3},children:t.jsx(p,{})}):t.jsxs(x,{sx:{p:3},children:[t.jsx(l,{variant:"h6",gutterBottom:!0,children:"Admin Indstillinger"}),m&&t.jsx(f,{severity:"error",sx:{mb:2},children:m}),j&&t.jsx(f,{severity:"success",sx:{mb:2},children:j}),t.jsxs(a,{sx:{mt:3},children:[t.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:"MobilePay Link"}),t.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Dette link bruges når beboere skal betale via MobilePay. Formatet skal være et gyldigt MobilePay-link."}),t.jsx(h,{fullWidth:!0,label:"MobilePay Link",value:e,onChange:e=>s(e.target.value),placeholder:"f.eks. https://mobilepay.dk/box/...",sx:{mb:3}}),t.jsx(a,{sx:{display:"flex",justifyContent:"flex-end"},children:t.jsx(c,{variant:"contained",color:"primary",onClick:async()=>{if(e.trim()){d(!0),u(""),g("");try{const t=re(be,"settings","admin");await ie(t,{mobilepayLink:e.trim(),lastUpdated:new Date}),g("Indstillinger gemt")}catch(t){u("Kunne ikke gemme indstillinger")}finally{d(!1)}}else u("MobilePay link kan ikke være tomt")},disabled:i,children:i?t.jsx(p,{size:24}):"Gem Ændringer"})})]})]})},sa=()=>{const[e,s]=n.useState(!1),[r,o]=n.useState(""),[i,d]=n.useState(""),[m,u]=n.useState(0),p=$(),j=()=>{"admin123"===r?(s(!0),d("")):d("Forkert adgangskode")};return e?t.jsxs(a,{sx:{minHeight:"100vh",bgcolor:"#f5f6fa",p:3},children:[t.jsxs(x,{sx:{mb:3,p:2},children:[t.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[t.jsx(l,{variant:"h5",component:"h1",children:"Admin Panel"}),t.jsx(c,{variant:"outlined",color:"primary",onClick:()=>{s(!1),o(""),p("/")},children:"Log ud"})]}),t.jsxs(V,{value:m,onChange:(e,t)=>{u(t)},sx:{borderBottom:1,borderColor:"divider","& .MuiTabs-flexContainer":{flexWrap:"wrap"}},children:[t.jsx(T,{label:"Produkter"}),t.jsx(T,{label:"Beskeder"}),t.jsx(T,{label:"Rapporter"}),t.jsx(T,{label:"Seneste Køb"}),t.jsx(T,{label:"Indstillinger"})]})]}),t.jsxs(a,{sx:{mt:3},children:[0===m&&t.jsx(Nt,{}),1===m&&t.jsx(Wt,{}),2===m&&t.jsx($t,{}),3===m&&t.jsx(aa,{}),4===m&&t.jsx(na,{})]})]}):t.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:"#f5f6fa",p:2},children:t.jsxs(x,{elevation:3,sx:{p:4,width:"100%",maxWidth:400,display:"flex",flexDirection:"column",gap:2},children:[t.jsx(l,{variant:"h5",component:"h1",gutterBottom:!0,align:"center",children:"Admin Login"}),i&&t.jsx(f,{severity:"error",children:i}),t.jsx(h,{fullWidth:!0,type:"password",label:"Adgangskode",value:r,onChange:e=>o(e.target.value),onKeyPress:e=>"Enter"===e.key&&j()}),t.jsx(c,{variant:"contained",color:"primary",fullWidth:!0,onClick:j,sx:{mt:2},children:"Log ind"})]})})};var ra={},oa=o;Object.defineProperty(ra,"__esModule",{value:!0});var ia=ra.default=void 0,la=oa(Ce()),ca=t;ia=ra.default=(0,la.default)((0,ca.jsx)("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications");const da=m(i)((({theme:e})=>({minHeight:"100vh",backgroundColor:"#f5f6fa",display:"flex",flexDirection:"column",padding:"16px",gap:"24px"}))),xa=m(a)((({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"24px",textAlign:"center"}))),ha=m(x)((({theme:e})=>({padding:"16px",marginBottom:"16px",borderRadius:"12px",backgroundColor:"#ffffff",boxShadow:"0 4px 6px rgba(0,0,0,0.1)",transition:"transform 0.3s ease","&:hover":{transform:"scale(1.02)"}}))),ma=m(c)((({theme:e})=>({marginTop:"16px",borderRadius:"8px",textTransform:"none"}))),ua=m(H)((({theme:e})=>({"& .MuiBadge-badge":{backgroundColor:e.palette.error.main,color:e.palette.error.contrastText}}))),pa=()=>{const[e,s]=n.useState([]),[r,o]=n.useState(!0),[i,d]=n.useState(null),[h,m]=n.useState(null),[j,g]=n.useState(!1),[b,v]=n.useState(!1),[y,k]=n.useState(null),[S,w]=n.useState([]),[C,M]=n.useState(0),[A,F]=n.useState(!1),N=n.useCallback((async()=>{try{o(!0),d(null);const e=await(async()=>{try{const e=ae(be,"rooms");return(await se(e)).docs.map((e=>({id:e.id,...e.data()})))}catch(i){throw i}})();0===e.length&&d("No rooms found. Please check your connection."),s(e)}catch(e){d(e.message||"Failed to load rooms")}finally{o(!1)}}),[]);n.useEffect((()=>{const e=e=>{e.preventDefault(),k(e),g(!0)};return window.addEventListener("beforeinstallprompt",e),N(),()=>{window.removeEventListener("beforeinstallprompt",e)}}),[N]);const W=async e=>{try{const t=await qe(e);m(t)}catch(t){d("Failed to load room details.")}},L=()=>{N()};n.useEffect((()=>{N()}),[N]);const R=n.useCallback((()=>{const e=localStorage.getItem("selectedRoom");if(!e)return;const t=ae(be,"notifications"),a=te(t,me("roomId","==",e),xe("timestamp","desc"),he(20)),n=ne(a,(e=>{const t=e.docs.map((e=>({id:e.id,...e.data(),timestamp:e.data().timestamp.toDate()})));w(t),M(t.filter((e=>!e.read)).length)}));return()=>n()}),[]);n.useEffect((()=>{R()}),[R]);return r?t.jsx(da,{children:t.jsxs(a,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",children:[t.jsx(p,{}),t.jsx(l,{variant:"body2",sx:{mt:2},children:"Henter værelser..."})]})}):i?t.jsx(da,{children:t.jsxs(a,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",children:[t.jsx(l,{variant:"h6",color:"error",children:"Fejl"}),t.jsx(l,{variant:"body1",children:i}),t.jsx(c,{variant:"contained",color:"primary",onClick:L,sx:{mt:2},children:"Prøv igen"})]})}):t.jsxs(da,{children:[t.jsxs(xa,{children:[t.jsx(l,{variant:"h4",gutterBottom:!0,children:"DormDrinks 6.sal"}),t.jsx(l,{variant:"subtitle1",color:"textSecondary",children:"Beer, Soda & Beyond"}),t.jsxs(a,{sx:{display:"flex",justifyContent:"center",mt:2},children:[t.jsx(u,{onClick:L,color:"primary",children:t.jsx(ot,{})}),t.jsx(u,{onClick:()=>g(!0),color:"secondary",children:t.jsx(ft,{})}),t.jsx(u,{onClick:()=>F(!0),color:"secondary",children:t.jsx(ua,{badgeContent:C,color:"error",children:t.jsx(ia,{})})})]})]}),i&&t.jsx(K,{open:!!i,autoHideDuration:6e3,onClose:()=>d(null),children:t.jsx(f,{severity:"error",onClose:()=>d(null),children:i})}),t.jsxs(I,{open:A,onClose:()=>F(!1),fullWidth:!0,maxWidth:"sm",children:[t.jsx(P,{children:t.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",children:["Beskeder",C>0&&t.jsx(c,{size:"small",color:"primary",onClick:async()=>{const e=localStorage.getItem("selectedRoom");if(e)try{const t=ae(be,"notifications"),a=te(t,me("roomId","==",e),me("read","==",!1)),n=await se(a),s=pe(be);n.forEach((e=>{s.update(e.ref,{read:!0})})),await s.commit(),M(0)}catch(t){}},children:"Markér alle som læst"})]})}),t.jsx(D,{children:0===S.length?t.jsx(l,{variant:"body2",color:"textSecondary",align:"center",children:"Ingen beskeder"}):t.jsx(E,{children:S.map((e=>t.jsx(z,{divider:!0,sx:{backgroundColor:e.read?"transparent":"#f0f0f0"},children:t.jsx(O,{primary:e.message,secondary:e.timestamp.toLocaleString()})},e.id)))})}),t.jsx(B,{children:t.jsx(c,{onClick:()=>F(!1),children:"Luk"})})]}),t.jsxs(I,{open:j,onClose:()=>g(!1),children:[t.jsx(P,{children:"Installer App"}),t.jsx(D,{children:t.jsx(l,{children:b?'For iOS: Tap the Share icon and then "Add to Home Screen"':"Installer DormDrinks 6.sal på din startskærm"})}),t.jsxs(B,{children:[t.jsx(c,{onClick:()=>g(!1),children:"Luk"}),!b&&t.jsx(c,{onClick:async()=>{if(b)alert('For iOS: Tap the Share icon and then "Add to Home Screen"');else if(y)try{await y.prompt();const{outcome:e}=await y.userChoice;k(null),g(!1)}catch(e){}},color:"primary",variant:"contained",children:"Installer"})]})]}),e.map((e=>t.jsxs(ha,{onClick:()=>W(e.id),children:[t.jsxs(a,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[t.jsx(l,{variant:"h6",children:e.occupantName||"Ukendt Beboer"}),t.jsxs(a,{display:"flex",alignItems:"center",children:[t.jsx(xt,{color:"primary"}),t.jsxs(l,{variant:"body1",ml:1,children:[e.balance||0," kr"]})]})]}),t.jsx(ma,{variant:"contained",color:"primary",fullWidth:!0,onClick:()=>W(e.id),children:"Se Detaljer"})]},e.id))),h&&t.jsxs(x,{sx:{p:2,mt:2},children:[t.jsx(l,{variant:"h5",children:"Rum Detaljer"}),t.jsxs(l,{children:["Navn: ",h.occupantName]}),t.jsxs(l,{children:["Saldo: ",h.balance," kr"]})]})]})},fa=()=>{const e=$(),[a,s]=n.useState(!0);return n.useEffect((()=>{(()=>{const t=navigator.userAgent||navigator.vendor||window.opera,a=/iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(t),n=window.innerWidth<=768,r="ontouchstart"in window||navigator.maxTouchPoints>0;e(a||n&&r?"/enhanced-mobile":"/",{replace:!0}),s(!1)})()}),[e]),a?t.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",flexDirection:"column",gap:"1rem",padding:"1rem",textAlign:"center"},children:[t.jsx("div",{children:"Indlæser..."}),t.jsx("div",{style:{fontSize:"0.875rem",color:"#666"},children:"Omdirigerer til den rigtige visning..."})]}):null};function ja(){return t.jsx(Y,{children:t.jsxs(U,{children:[t.jsx(G,{path:"/detect",element:t.jsx(fa,{})}),t.jsx(G,{path:"/PWAVIEW",element:t.jsx(nt,{})}),t.jsx(G,{path:"/mobile",element:t.jsx(pa,{})}),t.jsx(G,{path:"/enhanced-mobile",element:t.jsx(Ft,{})}),t.jsx(G,{path:"/admin",element:t.jsx(sa,{})}),t.jsxs(G,{path:"/",element:t.jsx(ge,{}),children:[t.jsx(G,{index:!0,element:t.jsx(Ee,{})}),t.jsx(G,{path:"room/:roomId",element:t.jsx(Je,{})})]}),t.jsx(G,{path:"*",element:t.jsx(J,{to:"/detect",replace:!0})})]})})}fe(document.getElementById("root")).render(t.jsx(n.StrictMode,{children:t.jsx(ja,{})}));
